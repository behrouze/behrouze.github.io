{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/raspberry-pi","result":{"pageContext":{"id":"6414a855-8c90-5aac-a82c-f5ee17604012","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/raspberry-pi.md","frontmatter":{"categories":["devops"],"date":"2020-06-02","lastUpdate":null,"tags":["cli","linux","raspberry-pi","systemctl","rfkill","wifi","blacklist"],"title":"Raspberry Pi"},"html":"<h1>Commandes spécifiques au Raspberry pi</h1>\n<p><code class=\"language-text\">sudo raspi-config</code> est la 1ère commande que l’on utilise dès qu’on installe un Raspberry pi (voir la <a href=\"https://www.raspberrypi.com/documentation/computers/configuration.html#raspi-config\">doc officielle</a>)</p>\n<p>En complément, il existe d’autres commandes comme <a href=\"https://github.com/Hexxeh/rpi-update#rpi-update\">rpi-update</a> qui permettent la MAJ du firmware du RPI.</p>\n<h1>Wi-Fi</h1>\n<h2>Status avec iwconfig</h2>\n<p>Pour vérifier l'état et gérer le wifi utiliser la commande <code class=\"language-text\">iwconfig</code></p>\n<blockquote>\n<p>iwconfig - configure a wireless network interface\nIwconfig is similar to ifconfig(8), but is dedicated to the wireless interfaces</p>\n</blockquote>\n<p>exemple:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iwconfig wlan0\nwlan0     IEEE <span class=\"token number\">802.11</span>  ESSID:off/any  \n          Mode:Managed  Access Point: Not-Associated   \n          Retry short limit:7   RTS thr:off   Fragment thr:off\n          Power Management:on</code></pre></div>\n<h2>Désactiver le Wi-Fi avec rfkill</h2>\n<p><code class=\"language-text\">rfkill</code> permet de lister et activer/désactiver le Wi-Fi</p>\n<blockquote>\n<p>rfkill - tool for enabling and disabling wireless devices</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> rfkill block <span class=\"token number\">0</span> <span class=\"token comment\"># pour blocker de device wifi 0 obtenu avec rfkill list</span>\n\n<span class=\"token function\">sudo</span> rfkill list\n<span class=\"token number\">0</span>: phy0: Wireless LAN\n\tSoft blocked: <span class=\"token function\">yes</span>\n\tHard blocked: no</code></pre></div>\n<p><em>Hard blocked</em> : est une désactivation matérielle (ou BIOS)\n<em>Soft blocked</em> : est une désactivation logicielle ou par driver</p>\n<h2>Wi-Fi is currently blocked by rfkill</h2>\n<p>Si le wifi est désactivé on risque de se retrouver avec le message suivant à chaque login..</p>\n<blockquote>\n<p>Wi-Fi is currently blocked by rfkill.\nUse raspi-config to set the country before use.</p>\n</blockquote>\n<p>pour s'en débarrasser utiliser <code class=\"language-text\">sudo raspi-config</code> en mode interactif ou en CLI <code class=\"language-text\">sudo raspi-config nonint do_wifi_country FR</code></p>\n<h1>Services a désactiver</h1>\n<p>Pour utiliser le Raspberry Pi en tant que serveur, nous n’avons pas besoin de certains services avec<br>\n<code class=\"language-text\">sudo systemctl disable xxx</code> :</p>\n<ul>\n<li>bluetooth.service</li>\n<li>wifi-country.service</li>\n<li>rpi-display-backlight.service</li>\n<li>disable dbus-org.freedesktop.Avahi.service</li>\n</ul>\n<h1>Modules a désactiver</h1>\n<p>Certains modules système comme ceux gérant le multimédia ne sont pas nécessaire à un fonctionnement headless du Raspberry pi, il suffit d’éditer le fichier <code class=\"language-text\">/etc/modprobe.d/blacklist.conf</code> pour cela et y <strong>ajouter</strong>:</p>\n<ul>\n<li>blacklist bcm2835_codec</li>\n<li>blacklist bcm2835_mmal_vchiq</li>\n<li>blacklist bcm2835_v4l2</li>\n<li>blacklist media</li>\n<li>blacklist snd</li>\n<li>blacklist snd_bcm2835</li>\n<li>blacklist snd_pcm</li>\n<li>blacklist snd_timer</li>\n<li>blacklist v4l2_common</li>\n<li>blacklist v4l2_mem2mem</li>\n<li>blacklist videobuf2_common</li>\n<li>blacklist videobuf2_dma_contig</li>\n<li>blacklist videobuf2_memops</li>\n<li>blacklist videobuf2_v4l2</li>\n<li>blacklist videobuf2_vmalloc</li>\n<li>blacklist videodev</li>\n</ul>"}},"staticQueryHashes":["1026020893","2750442709","28434099"]}