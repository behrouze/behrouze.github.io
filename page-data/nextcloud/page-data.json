{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/nextcloud",
    "result": {"pageContext":{"id":"e38a5640-6c3a-5310-9cca-993a4337834c","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/nextcloud.md","frontmatter":{"categories":["devops"],"date":"2020-03-31","lastUpdate":"2022-01-24","tags":["linux","raspberry-pi"],"title":"Nextcloud"},"html":"<p><a href=\"https://nextcloud.com/\">Nextcloud</a> est un √©quivalent Open Source de <em>Dropbox</em> ou de <em>Google Drive</em>, et dispose comme ceux-ci de clients <em>Android</em>, <em>IOS</em> ou encore <em>Windows</em>, <em>OSX</em> ou <em>Linux</em>.</p>\n<p>Les <strong>avantages</strong> :</p>\n<ul>\n<li>r√©cup√©rer le <strong>contr√¥le de nos donn√©es personnelles</strong> üìà puisqu‚Äôon les h√©berge nous m√™me</li>\n<li>ne <strong>pas payer d‚Äôabonnement</strong> üí∞</li>\n<li>disposer d'une quantit√© de stockage en ligne √©norme</li>\n</ul>\n<p>Les <strong>inconv√©nients</strong>:</p>\n<ul>\n<li>il faut g√©rer la partie serveur soi meme (installation, mises √† jour de Nextcloud)</li>\n<li><strong>s√©curiser</strong> notre infrastructure, faute de quoi on risquerait de s‚Äôexposer √† la fuite de toutes nos donn√©es‚Ä¶ üò±</li>\n</ul>\n<h1>Dropbox et Google Drive</h1>\n<p>Les grands acteurs actuels fournissent des espaces de stockages gratuits qui comportent certaines limitations :</p>\n<ul>\n<li>Google drive nous offre (03/2020) <strong>15 Go</strong> <em>en version gratuite</em> mais ces <strong>15Go sont partag√©e</strong> ? entre les <strong>Gmail</strong>, les <strong>Google Photos</strong> et <strong>Drive</strong>‚Ä¶ Et remplir cet espace partag√© nous force √† prendre l‚Äôabonnement pro imm√©diatement pour ne pas bloquer la r√©ception de ses mails‚Ä¶</li>\n<li>Dropbox <a href=\"https://www.dropbox.com/plans\">d√©marrent √† 10‚Ç¨ par mois</a> pour <strong>2 To</strong> de stockage.</li>\n</ul>\n<p>Bien sur il existe de <a href=\"https://www.cloudwards.net/top-10-secure-dropbox-alternatives/\">nombreuses alternatives √† Nextcloud, Droptbox et Google Drive</a> fournissant des services de stockage, √† choisir en fonction de ses exigences en terme de s√©curit√©, fonctionnalit√© et tarifs.</p>\n<h1>Installation sous Linux</h1>\n<h2>Installer les pr√©-requis</h2>\n<p>Il faut tout d‚Äôabord installer les <a href=\"https://docs.nextcloud.com/server/15/admin_manual/installation/system_requirements.html#server\">outils n√©cessaire √† l‚Äôex√©cution de Nextcloud</a>, √† savoir notre <strong>serveur web Nginx</strong>, un <strong>pr√©processeur PHP php-fpm</strong> (supporte max v7.3 pour Nextcloud 18) et des <strong>modules PHP</strong> n√©cessaires et une <strong>base de donn√©es</strong>, il faudra choisir entre SQLite (pour un usage personnel), MariaDB ou autres.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -y <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">curl</span> <span class=\"token punctuation\">\\</span>\n\tnginx <span class=\"token punctuation\">\\</span>\n\tphp7.3-fpm <span class=\"token punctuation\">\\</span>\n\tphp7.3-intl <span class=\"token punctuation\">\\</span>\n\tphp7.3-ldap <span class=\"token punctuation\">\\</span>\n\tphp7.3-imap <span class=\"token punctuation\">\\</span>\n\tphp7.3-gd <span class=\"token punctuation\">\\</span>\n\tphp7.3-pgsql <span class=\"token punctuation\">\\</span>\n\tphp7.3-curl <span class=\"token punctuation\">\\</span>\n\tphp7.3-xml <span class=\"token punctuation\">\\</span>\n\tphp7.3-zip <span class=\"token punctuation\">\\</span>\n\tphp7.3-mbstring <span class=\"token punctuation\">\\</span>\n\tphp7.3-soap <span class=\"token punctuation\">\\</span>\n\tphp7.3-smbclient <span class=\"token punctuation\">\\</span>\n\tphp7.3-json <span class=\"token punctuation\">\\</span>\n\tphp7.3-gmp <span class=\"token punctuation\">\\</span>\n\tphp7.3-bz2 <span class=\"token punctuation\">\\</span>\n\tphp-pear <span class=\"token punctuation\">\\</span>\n\tlibbz2-dev <span class=\"token punctuation\">\\</span>\n\tphp-intl <span class=\"token punctuation\">\\</span>\n\tphp-imagick <span class=\"token punctuation\">\\</span>\n\tphp7.3-mysql <span class=\"token punctuation\">\\</span>\n\tphp-apcu <span class=\"token punctuation\">\\</span></code></pre></div>\n<h2>R√©cup√©rer les fichiers √† installer de Nextcloud</h2>\n<p>Il faut ensuite r√©cup√©rer l‚Äôarchive de la derni√®re version disponible de Nextcloud (ex ici: nextcloud-18.0.2.tar.bz2) et la d√©compresser.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /tmp\n<span class=\"token function\">curl</span> https://download.nextcloud.com/server/releases/nextcloud-18.0.2.tar.bz2 -o nextcloud-18.0.2.tar.bz2\n<span class=\"token function\">sudo</span> -u www-data <span class=\"token function\">tar</span> xvjf nextcloud-18.0.3.tar.bz2 -C /var/www</code></pre></div>\n<h1>Installation et configuration via occ</h1>\n<p>Nextcloud nous met √† disposition un <a href=\"https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html#maintenance-commands\">maintenance de notre installation Nextcloud</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> /var/www/nextcloud/\n<span class=\"token function\">sudo</span> -u www-data php occ list <span class=\"token comment\"># help</span>\n<span class=\"token function\">sudo</span> -u www-data php occ maintenance:install --database <span class=\"token string\">\"mysql\"</span> --database-name <span class=\"token string\">\"nextcloud\"</span> --database-user <span class=\"token string\">\"root\"</span> --database-pass <span class=\"token string\">\"password\"</span> --admin-user <span class=\"token string\">\"admin\"</span> --admin-pass <span class=\"token string\">\"password\"</span></code></pre></div>\n<h2>Configuration de php-fpm</h2>\n<p>J‚Äôutilise exclusivement des Nginx et non des Apaches en tant que serveurs web ou reverse proxies, pour pouvoir processer du PHP il faut donc une installation fonctionnelle de php-fpm:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># d√©commenter les lignes suivantes dans /etc/php/7.3/fpm/pool.d/www.conf</span>\nenv<span class=\"token punctuation\">[</span><span class=\"token environment constant\">HOSTNAME</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token environment constant\">$HOSTNAME</span>\nenv<span class=\"token punctuation\">[</span><span class=\"token environment constant\">PATH</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> /usr/local/bin:/usr/bin:/bin\nenv<span class=\"token punctuation\">[</span>TMP<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> /tmp\nenv<span class=\"token punctuation\">[</span>TMPDIR<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> /tmp\nenv<span class=\"token punctuation\">[</span>TEMP<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> /tmp\n\nclear_env <span class=\"token operator\">=</span> no\n\n<span class=\"token comment\"># param√©trer la taille MAX autoris√©s pour les uploads /etc/php/7.3/fpm/php.ini</span>\npost_max_size <span class=\"token operator\">=</span> 300M\nupload_max_filesize <span class=\"token operator\">=</span> 300M\n\n<span class=\"token comment\"># configurer un pool php-fpm avec un unixsocket</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">POOL_CONF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">$PHP_POOL_DIR</span>\"</span>/nextcloud.conf</span>\n[Nextcloud]\nuser = www-data\ngroup = www-data\nlisten = /run/php/php\"<span class=\"token variable\">$PHPVER</span>\"-fpm.nextcloud.sock\nlisten.owner = www-data\nlisten.group = www-data\npm = dynamic\n; max_children is set dynamically with calculate_php_fpm()\npm.max_children = 8\npm.start_servers = 3\npm.min_spare_servers = 2\npm.max_spare_servers = 3\nenv[HOSTNAME] = <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">hostname</span> -f<span class=\"token variable\">)</span></span>\nenv[PATH] = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\nsecurity.limit_extensions = .php\nphp_admin_value [cgi.fix_pathinfo] = 1\n; Optional\n; pm.max_requests = 2000\nPOOL_CONF</span>\n\n<span class=\"token function\">sudo</span> -u www-data php7.3 occ <span class=\"token comment\"># &lt;======== version php a sp√©cifier</span>\n\n\n<span class=\"token comment\"># si pb de version PHP:</span>\n<span class=\"token function\">vi</span> lib/versioncheck.php <span class=\"token comment\"># et modifier le if..</span></code></pre></div>\n<h2>Permissions sur le syst√®me de fichiers</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> -R www-data:www-data nextcloud\n<span class=\"token function\">sudo</span> <span class=\"token function\">find</span> nextcloud/ -type d -exec <span class=\"token function\">chmod</span> <span class=\"token number\">750</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">find</span> nextcloud/ -type f -exec <span class=\"token function\">chmod</span> <span class=\"token number\">640</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pour un upgrade √† la mano de son installation <a href=\"https://docs.nextcloud.com/server/18/admin_manual/maintenance/manual_upgrade.html?highlight=upgrade\">utiliser cette doc</a>.</p>\n<h1>Mises √† jour</h1>\n<p>Les mises √† jour peuvent √™tre effectu√©es depuis l‚Äôinterface d‚Äôadmin mais aussi avec la command <code class=\"language-text\">occ</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> -u www-data php7.3 occ update:check</code></pre></div>\n<p><em>La commande pr√©c√©dente (<code class=\"language-text\">occ update</code>) retourne ce type d‚Äôinfos:</em><br>\n<em>Nextcloud 18.0.3 is available. Get more information on how to update at</em></p>\n<h2>Mise √† jour de la version de Nextcloud</h2>\n<p>La mise √† jour peut √™tre effectu√©e manuellement en suivant la <a href=\"https://docs.nextcloud.com/server/18/admin_manual/maintenance/manual_upgrade.html\">proc√©dure</a> ou en utilisant l‚Äôinterface d‚Äôadmin:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ae1506ae13603196570ca1e1b2f422d/cecac/2020-03-31-11_53_10-Window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.04225352112675%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbUlEQVQ4y5WTTVKDQBCF2esZXHgUL+Cx3Frl3rVnsSxNzMql/ARQQQZ6Zpjp7hkLSGJiYgKv3oKC+XjddBNc3c+vH94ubp8v717Obx7Ppjh4CstFrl4zucjVPJPzTM4yOUthx8PNPQdsjV8JuQVSjXfsxymQSrPzxM4iJss0TpZpln9XQmotVWeQConZuW0Tdw601t575xwTJXEcRlEUR1EUvYdhEscfn19pmgoh6l0hovdbMBHleR7FcVEUxhhrrTGrjnhPrtcvjIhCiEoIADBtq7UejmyO7usXbrEVvaqqKoqiLEsAcP+Cu7BB00DTNA2A1L2UUkdid2BLFgCge0HNvJqWc6OTh5orIY4HHoLJDCMpy7Ku64mwMQBQN7VFHJ758TARtf2ErLXUC4nGws5xtxkWh/VARJoCO0SLaw0ffAJs1zqZ+Rdm5q7avuah8pMD20pm7uvt+95cWTtqt9l1v/TI9TjQ88hWN/APfYKwJzLMyIsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 03 31 11 53 10 Window\"\n        title=\"2020 03 31 11 53 10 Window\"\n        src=\"/static/3ae1506ae13603196570ca1e1b2f422d/cecac/2020-03-31-11_53_10-Window.png\"\n        srcset=\"/static/3ae1506ae13603196570ca1e1b2f422d/3cb16/2020-03-31-11_53_10-Window.png 213w,\n/static/3ae1506ae13603196570ca1e1b2f422d/2fbbf/2020-03-31-11_53_10-Window.png 425w,\n/static/3ae1506ae13603196570ca1e1b2f422d/cecac/2020-03-31-11_53_10-Window.png 728w\"\n        sizes=\"(max-width: 728px) 100vw, 728px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Process de mise √† jour de Nextcloud via l‚Äôinterface d‚Äôadmin</p>\n<h2>Mise √† jour d‚Äôapplications Nextcloud</h2>\n<p>Se connecter en <em>admin</em> et depuis le <em>menu</em> apparaissant lorsqu‚Äôon clique sur l‚Äô<em>ic√¥ne du profile</em> (tout en haut √† droite) et aller dans les applications:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8294d52966ba2daf29c4aa2cbf637a0b/000c7/2020-03-31-11_13_05-Window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.821596244131456%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAz0lEQVQY032NsUoDYRCE/wdN6RuImDO5wsoihVwuetjYSXKawxArbQQbK4uUPoIiKYzJz+3O7MrdWYn4sSzDDjMb8un9yeVdWlTHF7dpUSXjsj8uD7NpkpfD/HqQzfrZ7GhyMzyv0rP53qDo7Z/2DrJkdDWaLIKKEGpGdzczQt1obLaL+G5rzcXMG3+1el0+PD8+vWzWa5E6fG6+WraiWovUtZAGEqS202hQAQV+Sro3ZHh7/4gxAnB3bem8P+mKAJI0s7CLUUS6DID/w7/4BntnDGlHtxSgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 03 31 11 13 05 Window\"\n        title=\"2020 03 31 11 13 05 Window\"\n        src=\"/static/8294d52966ba2daf29c4aa2cbf637a0b/ae694/2020-03-31-11_13_05-Window.png\"\n        srcset=\"/static/8294d52966ba2daf29c4aa2cbf637a0b/3cb16/2020-03-31-11_13_05-Window.png 213w,\n/static/8294d52966ba2daf29c4aa2cbf637a0b/2fbbf/2020-03-31-11_13_05-Window.png 425w,\n/static/8294d52966ba2daf29c4aa2cbf637a0b/ae694/2020-03-31-11_13_05-Window.png 850w,\n/static/8294d52966ba2daf29c4aa2cbf637a0b/000c7/2020-03-31-11_13_05-Window.png 1137w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Mise √† jour d‚Äôune application Nextcloud depuis l‚Äôinterface d‚Äôadmin</p>\n<h1>S√©curit√©</h1>\n<p>Il faut garder en t√™te que tout serveur web mis en ligne est soumis √† des attaques en permanence, c‚Äôest pourquoi si vous souhaitez h√©berg√© votre propre Nextcloud, il va falloir mettre en place quelques protections, √† commencer par la mise √† jour permanente de tous les composants de votre installation.</p>\n<p>Ensuite Nextcloud nous met √† disposition un scanner de vuln√©rabilit√©s sur</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d8699c73fee51e7f76f3b2ae4a511c8e/0f586/2020-03-31-13_25_09-Window.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.75117370892019%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABrUlEQVQoz42Sy27UMBSG83JIjJBYsGTPeyG1SCA2PAZbQLRMJYZRMzO0k4vvPhfHPijJMBS1lPn0yU6O/OfElqvF2dcnr7+8fP/t1YerZ+cXL94tn79dLs4vF28e8OnZxV0rSSj9rdzupG9FhMH7viGn0WnyZhydIafBqqA7KVnuUOVc8kwZISLvPRI1bft9tao3m7quQwgRIMQ4TMuOVuWAzBMzI2EIoe/7XhulTa+084GZOfHvFgeqcg8RGYaBmSkNlAZOmVP+8/lHwsxsjM35sLcA3NtoIzlKgdLwr845FynCCWp9LSJTL3HB75vGOnfc7V9hkSIy/pOIxFQ+7uKnHzefL39OdWGmEAPECBARcV58tFLACrgLuNd+09urDq47WN3Yua4gKUh6HPm+VW1wY2nd+eW2Xe66ded3jnaea4OjGmqNo+YBq63BrcFahXVjV3u7atxmzOBcf9yKUqaUI7J2wYXIQ54rpzgfmBBh27a90jgCiECINI3zKxONzzAypHQ4sPlWIKEx1lofI0x5zLn8l0MYCIw1zHy89KWcHmZQWhlraSKldEr4F2fsi0nFdJahAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 03 31 13 25 09 Window\"\n        title=\"2020 03 31 13 25 09 Window\"\n        src=\"/static/d8699c73fee51e7f76f3b2ae4a511c8e/ae694/2020-03-31-13_25_09-Window.png\"\n        srcset=\"/static/d8699c73fee51e7f76f3b2ae4a511c8e/3cb16/2020-03-31-13_25_09-Window.png 213w,\n/static/d8699c73fee51e7f76f3b2ae4a511c8e/2fbbf/2020-03-31-13_25_09-Window.png 425w,\n/static/d8699c73fee51e7f76f3b2ae4a511c8e/ae694/2020-03-31-13_25_09-Window.png 850w,\n/static/d8699c73fee51e7f76f3b2ae4a511c8e/3f20e/2020-03-31-13_25_09-Window.png 1275w,\n/static/d8699c73fee51e7f76f3b2ae4a511c8e/0f586/2020-03-31-13_25_09-Window.png 1498w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>scan.nextcloud.com</p>\n<h1>Troubleshooting</h1>\n<h2>Limite de m√©moire PHP est inf√©rieure √† la valeur recommand√©e de 512Mo</h2>\n<p>Si vous recevez le message <em>La limite de m√©moire PHP est inf√©rieure √† la valeur recommand√©e de 512Mo</em>, il suffit de modifier la ligne :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># √©diter le fichier /etc/php/7.3/fpm/pool.d/www.conf</span>\nphp_admin_value<span class=\"token punctuation\">[</span>memory_limit<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> 512M</code></pre></div>\n<p>puis red√©marrer le service php-fpm :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> systemctl restart php7.3-fpm</code></pre></div>\n<h2>Upstream sent too big header</h2>\n<p>Si vous trouvez dans vos logs d‚Äôerreur Nginx un message du type <em>upstream sent too big header while reading response header from upstream</em>, c‚Äôest au niveau de la conf Nginx qu‚Äôil faut agir.<br>\nAjouter dans votre directive server : <code class=\"language-text\">fastcgi_buffer_size 32k;</code><br>\nEt pour comprendre et bien dimensionner ce buffer <a href=\"https://markshust.com/2020/01/02/resolving-upstream-sent-too-big-header-error-nginx/\">aussi</a>.</p>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://ma.ttias.be/a-better-way-to-run-php-fpm/\">optimisation de sa config php-fpm</a></li>\n</ul>\n<h1>OCC</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> -u www-data php7.3 occ -v\nPartage de fichiers <span class=\"token number\">17.0</span>.2\n\n<span class=\"token comment\"># OCC</span>\n<span class=\"token comment\"># Usage:</span>\n  <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>arguments<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># Options:</span>\n  -h, --help            Display this <span class=\"token builtin class-name\">help</span> message\n  -q, --quiet           Do not output any message\n  -V, --version         Display this application version\n      --ansi            Force ANSI output\n      --no-ansi         Disable ANSI output\n  -n, --no-interaction  Do not ask any interactive question\n      --no-warnings     Skip global warnings, show <span class=\"token builtin class-name\">command</span> output only\n  -v<span class=\"token operator\">|</span>vv<span class=\"token operator\">|</span>vvv, --verbose  Increase the verbosity of messages: <span class=\"token number\">1</span> <span class=\"token keyword\">for</span> normal output, <span class=\"token number\">2</span> <span class=\"token keyword\">for</span> <span class=\"token function\">more</span> verbose output and <span class=\"token number\">3</span> <span class=\"token keyword\">for</span> debug\n\nAvailable commands:\n  check                               check dependencies of the server environment\n  <span class=\"token builtin class-name\">help</span>                                Displays <span class=\"token builtin class-name\">help</span> <span class=\"token keyword\">for</span> a <span class=\"token builtin class-name\">command</span>\n  list                                Lists commands\n  status                              show some status information\n  upgrade                             run upgrade routines after installation of a new release. The release has to be installed before.\n activity\n  activity:send-mails                 Sends the activity notification mails\n app\n  app:check-code                      check code to be compliant\n  app:disable                         disable an app\n  app:enable                          <span class=\"token builtin class-name\">enable</span> an app\n  app:getpath                         Get an absolute path to the app directory\n  app:install                         <span class=\"token function\">install</span> an app\n  app:list                            List all available apps\n  app:remove                          remove an app\n  app:update                          update an app or all apps\n background\n  background:ajax                     Use ajax to run background <span class=\"token function\">jobs</span>\n  background:cron                     Use <span class=\"token function\">cron</span> to run background <span class=\"token function\">jobs</span>\n  background:webcron                  Use webcron to run background <span class=\"token function\">jobs</span>\n config\n  config:app:delete                   Delete an app config value\n  config:app:get                      Get an app config value\n  config:app:set                      Set an app config value\n  config:import                       Import a list of configs\n  config:list                         List all configs\n  config:system:delete                Delete a system config value\n  config:system:get                   Get a system config value\n  config:system:set                   Set a system config value\n dav\n  dav:create-addressbook              Create a dav addressbook\n  dav:create-calendar                 Create a dav calendar\n  dav:list-calendars                  List all calendars of a user\n  dav:move-calendar                   Move a calendar from an user to another\n  dav:remove-invalid-shares           Remove invalid dav shares\n  dav:send-event-reminders            Sends event reminders\n  dav:sync-birthday-calendar          Synchronizes the birthday calendar\n  dav:sync-system-addressbook         Synchronizes <span class=\"token function\">users</span> to the system addressbook\n db\n  db:add-missing-indices              Add missing indices to the database tables\n  db:convert-filecache-bigint         Convert the ID columns of the filecache to BigInt\n  db:convert-mysql-charset            Convert charset of MySQL/MariaDB to use utf8mb4\n  db:convert-type                     Convert the Nextcloud database to the newly configured one\n encryption\n  encryption:change-key-storage-root  Change key storage root\n  encryption:decrypt-all              Disable server-side encryption and decrypt all files\n  encryption:disable                  Disable encryption\n  encryption:enable                   Enable encryption\n  encryption:encrypt-all              Encrypt all files <span class=\"token keyword\">for</span> all <span class=\"token function\">users</span>\n  encryption:list-modules             List all available encryption modules\n  encryption:set-default-module       Set the encryption default module\n  encryption:show-key-storage-root    Show current key storage root\n  encryption:status                   Lists the current status of encryption\n files\n  files:cleanup                       cleanup filecache\n  files:recommendations:recommend\n  files:scan                          rescan filesystem\n  files:scan-app-data                 rescan the AppData folder\n  files:transfer-ownership            All files and folders are moved to another user - shares are moved as well.\n group\n  group:add                           Add a group\n  group:adduser                       <span class=\"token function\">add</span> a user to a group\n  group:delete                        Remove a group\n  group:list                          list configured <span class=\"token function\">groups</span>\n  group:removeuser                    remove a user from a group\n integrity\n  integrity:check-app                 Check integrity of an app using a signature.\n  integrity:check-core                Check integrity of core code using a signature.\n  integrity:sign-app                  Signs an app using a private key.\n  integrity:sign-core                 Sign core using a private key.\n l10n\n  l10n:createjs                       Create javascript translation files <span class=\"token keyword\">for</span> a given app\n log\n  log:file                            manipulate logging backend\n  log:manage                          manage logging configuration\n  log:tail                            Tail the nextcloud logfile\n  log:watch                           Watch the nextcloud logfile\n maintenance\n  maintenance:data-fingerprint        update the systems data-fingerprint after a backup is restored\n  maintenance:mimetype:update-db      Update database mimetypes and update filecache\n  maintenance:mimetype:update-js      Update mimetypelist.js\n  maintenance:mode                    <span class=\"token builtin class-name\">set</span> maintenance mode\n  maintenance:repair                  repair this installation\n  maintenance:theme:update            Apply custom theme changes\n  maintenance:update:htaccess         Updates the .htaccess <span class=\"token function\">file</span>\n migrations\n  migrations:execute                  Execute a single migration version manually.\n  migrations:generate\n  migrations:generate-from-schema\n  migrations:migrate                  Execute a migration to a specified version or the latest available version.\n  migrations:status                   View the status of a <span class=\"token builtin class-name\">set</span> of migrations.\n notification\n  notification:generate               Generate a notification <span class=\"token keyword\">for</span> the given user\n preview\n  preview:delete_old                  Delete old preview folder <span class=\"token punctuation\">(</span>pre NC11<span class=\"token punctuation\">)</span>\n  preview:generate-all                Generate previews\n  preview:pre-generate                Pre generate previews\n security\n  security:certificates               list trusted certificates\n  security:certificates:import        <span class=\"token function\">import</span> trusted certificate\n  security:certificates:remove        remove trusted certificate\n sharing\n  sharing:cleanup-remote-storages     Cleanup shared storage entries that have no matching entry <span class=\"token keyword\">in</span> the shares_external table\n trashbin\n  trashbin:cleanup                    Remove deleted files\n  trashbin:expire                     Expires the <span class=\"token function\">users</span> trashbin\n twofactorauth\n  twofactorauth:cleanup               Clean up the two-factor user-provider association of an uninstalled/removed provider\n  twofactorauth:disable               Disable two-factor authentication <span class=\"token keyword\">for</span> a user\n  twofactorauth:enable                Enable two-factor authentication <span class=\"token keyword\">for</span> a user\n  twofactorauth:enforce               Enabled/disable enforced two-factor authentication\n  twofactorauth:state                 Get the two-factor authentication <span class=\"token punctuation\">(</span>2FA<span class=\"token punctuation\">)</span> state of a user\n update\n  update:check                        Check <span class=\"token keyword\">for</span> server and app updates\n user\n  user:add                            adds a user\n  user:delete                         deletes the specified user\n  user:disable                        disables the specified user\n  user:enable                         enables the specified user\n  user:info                           show user info\n  user:lastseen                       shows when the user was logged <span class=\"token keyword\">in</span> last <span class=\"token function\">time</span>\n  user:list                           list configured <span class=\"token function\">users</span>\n  user:report                         shows how many <span class=\"token function\">users</span> have access\n  user:resetpassword                  Resets the password of the named user\n  user:setting                        Read and modify user settings\n versions\n  versions:cleanup                    Delete versions\n  versions:expire                     Expires the <span class=\"token function\">users</span> <span class=\"token function\">file</span> versions</code></pre></div>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}