{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/mariadb-mysql",
    "result": {"pageContext":{"id":"147bc0c7-4427-5cd5-bd88-f00348f96a03","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/mariadb-mysql.md","frontmatter":{"categories":["devops"],"date":"2022-02-16","lastUpdate":"2022-02-16","tags":["sql","mariadb","mysql","tips","cli","cheatsheet"],"title":"MariaDB MySQL"},"html":"<h1>Use DB ou prefixe</h1>\n<h2>Use</h2>\n<p>Pour utiliser une table il est possible de se placer sur la DB souhaitée avec <code class=\"language-text\">USE xxx;</code> puis executer les commandes dessus :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">USE</span> mysql<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>L'interet de cette syntaxe, est qu'en mode interactif, cela nous évite de tapper le préfixe à chaque commande pour une succession de commandes concernant la meme table.</p>\n<h2>Prefixe</h2>\n<p>il est possible de prefixer le nom des tables par le nom de la base :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>L'interet de cette seconde syntaxe est qu'elle est plus rapide pour exécuter 1 seule commtande sur une autre table comme ci-dessus sur une table système.</p>\n<h1>Afficher des infos</h1>\n<h2>Schéma BDD</h2>\n<p>Les 3 commandes suivantes sont équivalente pour obtenir les schéma de la BDD courante:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">DATABASES</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> SCHEMAS<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SELECT</span> schema_name <span class=\"token keyword\">FROM</span> information_schema<span class=\"token punctuation\">.</span>schemata<span class=\"token punctuation\">;</span></code></pre></div>\n<p>attention si l'option <code class=\"language-text\">--skip-show-database</code> a été utilisé pour lancer le serveur, aucune info ne sera retournée à moins d'avoir le privilege <code class=\"language-text\">SHOW DATABASES</code>.</p>\n<h3>Filtrer</h3>\n<p>Pour affiner les recherches utliser l'opérateur <code class=\"language-text\">LIKE</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">DATABASES</span> <span class=\"token operator\">LIKE</span> <span class=\"token string\">\"wp%\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Tables</h2>\n<p>Pour lister les tables</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">TABLES</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">FULL</span> <span class=\"token keyword\">TABLES</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">--montre le table_type \"BASE TABLE\" ou \"VIEW\"</span></code></pre></div>\n<p>Filtrer avec <code class=\"language-text\">LIKE</code> ou <code class=\"language-text\">WHERE</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">FULL</span> <span class=\"token keyword\">TABLES</span> <span class=\"token keyword\">WHERE</span> table_type <span class=\"token operator\">=</span> <span class=\"token string\">'VIEW'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">FULL</span> <span class=\"token keyword\">TABLES</span> <span class=\"token operator\">LIKE</span> <span class=\"token string\">\"%post%\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pour avoir des infos sur la structure d'une table</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DESC</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DESCRIBE</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">FULL</span> <span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Le mot clé FULL ajoute les champs <code class=\"language-text\">collation</code>, <code class=\"language-text\">privileges</code> et <code class=\"language-text\">comment</code></p>\n<h3>Filtrer</h3>\n<p>Filtrer <code class=\"language-text\">SHOW [FULL] COLUMNS</code> avec <code class=\"language-text\">LIKE</code> ou <code class=\"language-text\">WHERE</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">FROM</span> wp_blog_behrouze<span class=\"token punctuation\">.</span>wp_posts <span class=\"token operator\">LIKE</span> <span class=\"token string\">\"post%\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">FROM</span> wp_blog_behrouze<span class=\"token punctuation\">.</span>wp_posts <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">Type</span> <span class=\"token operator\">LIKE</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Users</h2>\n<h3>Utilisateur courant</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> <span class=\"token keyword\">current_user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------+</span>\n<span class=\"token operator\">|</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>         <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------+</span>\n<span class=\"token operator\">|</span> root<span class=\"token variable\">@localhost</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------+</span>\n<span class=\"token number\">1</span> <span class=\"token keyword\">row</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.001</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Liste des utilisateurs de la BDD</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">,</span> host <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">,</span>\n    host<span class=\"token punctuation\">,</span>\n    is_role<span class=\"token punctuation\">,</span>\n    password_expired<span class=\"token punctuation\">,</span>\n    Password\n<span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Permissions</h2>\n<p>Les Users sont créés de base sans aucun droits, c'est le <code class=\"language-text\">GRANT USAGE</code> , cela leurs permets uniquement de se logger.</p>\n<p>Pour checker les permissions du user avec lequel on s'est connecté:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> GRANTS<span class=\"token punctuation\">;</span>  <span class=\"token comment\">-- équivalent à SHOW GRANTS FOR CURRENT_USER; ou CURRENT_USER();</span></code></pre></div>\n<p>Pour lister les users de la BDD (et avoir la combinaison <code class=\"language-text\">user@host</code>) :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> GRANTS <span class=\"token keyword\">FOR</span> le_user_a_checker<span class=\"token variable\">@le_host</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A noter qu'il est possible d'écrire:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token string\">'username'</span><span class=\"token variable\">@'hostname'</span>\n<span class=\"token string\">\"username\"</span><span class=\"token variable\">@\"hostname\"</span>\n<span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`hostname`</span></code></pre></div>\n<h2>Threads courants</h2>\n<p>Les 2 commandes suivantes sont équivalentes:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> PROCESSLIST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">user</span><span class=\"token punctuation\">,</span>\n    host<span class=\"token punctuation\">,</span>\n    db<span class=\"token punctuation\">,</span>\n    command<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">time</span><span class=\"token punctuation\">,</span>\n    State<span class=\"token punctuation\">,</span>\n    Info<span class=\"token punctuation\">,</span>\n    Progress\n<span class=\"token keyword\">FROM</span> information_schema<span class=\"token punctuation\">.</span>processlist<span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Créations</h1>\n<h2>User</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span><span class=\"token punctuation\">]</span> user_a_creer\nIDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'password'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">user_a_creer</code> peut etre une combinaison <code class=\"language-text\">nom_user@host</code> ou juste <code class=\"language-text\">nom_user</code> auquel cas le host attribué est <code class=\"language-text\">%</code> automatiquement. La partie host designe la machine depuis laquel ce user pourra se connecter, et <code class=\"language-text\">%</code> signifie <em>depuis partout</em> (donc attention on permet les remote access) !</p>\n<p>Pour modifier le mot de passe du user précédement créé :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">USER</span> user_a_creer IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mon_nouveau_password'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>⚠ <em>Attention</em> si on utilise la syntaxe <code class=\"language-text\">IDENTIFIED BY PASSWORD</code> au lieu de <code class=\"language-text\">IDENTIFIED BY</code>, le SGDBD s'attendra a recevoir un <a href=\"https://mariadb.com/kb/en/grant/#identified-by-password-password_hash\">hash de password</a> que l'on obtiendra grâce à la fonction <a href=\"https://mariadb.com/kb/en/password/\"><code class=\"language-text\">PASSWORD</code></a> par un <code class=\"language-text\">SELECT PASSWORD('mon_super_password');</code> ce qu'il nous fera comprendre par un message :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">ERROR <span class=\"token number\">1372</span> <span class=\"token punctuation\">(</span>HY000<span class=\"token punctuation\">)</span>: Password <span class=\"token keyword\">hash</span> should be a <span class=\"token number\">41</span><span class=\"token operator\">-</span>digit hexadecimal number</code></pre></div>\n<h2>Permissions</h2>\n<p>Une fois le User créé il faut lui attribuer des droits pour qu'il puisse interagir avec la BDD.\nLes permissions (ou droits) sont associés à la <code class=\"language-text\">database</code>, un <code class=\"language-text\">table</code>, une routine, ou à des <code class=\"language-text\">columns</code> particulière d'une table.\nL'attribution de ces droits se fait a l'aide de l'instruction <code class=\"language-text\">GRANT</code>, et on <em>attribue le droit XXX sur l'élément de BDD à l'utilisateur nom_user</em> comme ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">GRANT</span> XXX \n<span class=\"token keyword\">ON</span> la_bdd_voulue<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> \n<span class=\"token keyword\">TO</span> nom_user<span class=\"token punctuation\">;</span></code></pre></div>\n<p>avec XXX le ou les <a href=\"https://mariadb.com/kb/en/grant/#table-privileges\">privileges a attribuer</a>, avec les plus courants: <code class=\"language-text\">ALL PRIVILEGES</code>, <code class=\"language-text\">SELECT</code>, <code class=\"language-text\">INSERT</code>, <code class=\"language-text\">UPDATE</code>, <code class=\"language-text\">DELETE</code>, <code class=\"language-text\">INDEX</code>, <code class=\"language-text\">GRANT OPTION</code></p>\net on vérifie les permissions attribuées avec un SHOW GRANTS FOR... voir <a href=\"/#permissions\" title=\"\"></a>\n<h2>Permissions particulières</h2>\n<h3>ALL PRIVILEGES</h3>\n<p>avec la permission <code class=\"language-text\">ALL PRIVILEGES</code> il nous est possible de toutes les attribuer (en dehors de <code class=\"language-text\">GRANT OPTION</code>) en une fois :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span>  <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">to</span> <span class=\"token string\">'nom_user'</span><span class=\"token variable\">@'localhost'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>USAGE</h3>\n<p>C'est la permission qui est attribuée par défaut à la création d'un utilisateur</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">MariaDB <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>none<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> toto IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mon_super_password'</span><span class=\"token punctuation\">;</span>\nQuery OK<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token keyword\">rows</span> affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.007</span> sec<span class=\"token punctuation\">)</span>\n\nMariaDB <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>none<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token keyword\">SHOW</span> GRANTS <span class=\"token keyword\">FOR</span> toto<span class=\"token variable\">@'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">--------------------------------------------------------+</span>\n<span class=\"token operator\">|</span> Grants <span class=\"token keyword\">for</span> toto@<span class=\"token operator\">%</span>                                                                                   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">--------------------------------------------------------+</span>\n<span class=\"token operator\">|</span> <span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">USAGE</span> <span class=\"token keyword\">ON</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>toto<span class=\"token punctuation\">`</span></span><span class=\"token variable\">@`%`</span> IDENTIFIED <span class=\"token keyword\">BY</span> PASSWORD <span class=\"token string\">'*A62D57DD7D1835DC24EE4D41B4400E32C40B46B6'</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">--------------------------------------------------------+</span>\n<span class=\"token number\">1</span> <span class=\"token keyword\">row</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.001</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>GRANT OPTION</h3>\n<p>Le privilège <code class=\"language-text\">GRANT OPTION</code> qui attribut le droit de modifier les permissions (à la hauteur des permission de l'utilisateur selectionné) n'est pas inclus dans le <code class=\"language-text\">ALL PRIVILEGES</code>.</p>\n<p>Pour attribuer ce droit particulier il faut compléter la requete précédente ainsi :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span>  <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">to</span> <span class=\"token string\">'nom_user'</span><span class=\"token variable\">@'localhost'</span> <span class=\"token keyword\">WITH</span> <span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">OPTION</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Connexion distant</h1>\n<p>Il faut tout d'abord disposer d'un client mysql : <code class=\"language-text\">sudo apt install mariadb-client -y</code>\nPour autoriser les connexion distantes il faut intervenir sur la configuration réseau du serveur, dans la config mariadb et dans le paramétrage de la base de données.\nUne fois le client installé, se connecter avec les credentials du user (créé pour une connexion distante avec soit <code class=\"language-text\">%</code> soit l'<code class=\"language-text\">adresse IP</code> en tant que host):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mysql -h host_name -u mon_user -p</code></pre></div>\n<h2>config Serveur</h2>\n<p>Coté serveur vérifier que le port mariadb/mysql <code class=\"language-text\">3306</code> (ou celui que vous aurez défini dans <code class=\"language-text\">/etc/mysql/mariadb.cnf</code>) est bien ouvert au niveau réseau :</p>\n<ul>\n<li>\nvérifier les config du firewall local <a href=\"/ufw\" title=\"ufw\">ufw</a> ou iptables -L\n</li>\n<li>vérifier que mysql écoute bien sur le port <code class=\"language-text\">3306</code> avec un <code class=\"language-text\">netstat -tupln</code></li>\n</ul>\n<h2>config mariadb</h2>\n<p>autoriser les connexions distantes au daemon <code class=\"language-text\">mariadbd</code> dans le fichier de config du serveur : <code class=\"language-text\">/etc/mysql/mariadb.conf.d/50-server.cnf</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">bind-address            <span class=\"token operator\">=</span> <span class=\"token number\">127.0</span>.0.1 <span class=\"token comment\"># interdit les connexions distantes</span>\nbind-address            <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>.0.0   <span class=\"token comment\"># autorise les connexions distantes</span></code></pre></div>\n<p>redémarrer le service :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> systemctl restart mariadb</code></pre></div>\n<h2>config en BDD</h2>\n<p>Attribuer les <a href=\"https://www.mysqltutorial.org/mysql-grant.aspx\">droits</a> (pas forcément <code class=\"language-text\">ALL</code>) au couple <code class=\"language-text\">username@host</code> à l'entité de BDD souhaitée:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GRANT ALL ON la_dbb.* to 'username'@'hostname' IDENTIFIED BY 'password'</code></pre></div>\n<p>Le <code class=\"language-text\">FLUSH PRIVILEGES</code> n'est pas nécessaire pour appliquer les modifs comme <a href=\"https://dev.mysql.com/doc/refman/8.0/en/privilege-changes.html\">indiqué dans la doc</a>.</p>\n<h1>Astuces</h1>\n<h3>Affichage en colonne</h3>\n<p>Pour un affichage plus lisible, surtout lors d'un <code class=\"language-text\">select *</code> mysql nous offre la possibilité d'afficher en mode colonne en finalisant la commande par <code class=\"language-text\">\\G;</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">user</span> <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">User</span> <span class=\"token operator\">LIKE</span> <span class=\"token string\">'usr_%'</span> \\G<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Mode interactif</h3>\n<p><code class=\"language-text\">CTRL + U</code> ou <code class=\"language-text\">CTRL + w</code> supprime les caractères précédent le curseur, donc tout ce qui est a sa gauche\n<code class=\"language-text\">CTRL + K</code> idem pour les caratères à droite jusqu'à la fin de ligne\n<code class=\"language-text\">CTRL + L</code> pour clear l'affichage</p>\n<p>MariaDB possède un ensemble de \"<em>commandes</em>\" exécutés dans une session interactive en saisissant par ex <code class=\"language-text\">\\? + ENTER</code>  pour obtenir l'accès à l'aide en ligne.</p>\n<p>Les commandes intéressantes sont :\n<code class=\"language-text\">\\G</code> affichage en colonne/vertical\n<code class=\"language-text\">\\e</code> pour editer la commande courante dans l'<code class=\"language-text\">$EDITOR</code>\n<code class=\"language-text\">\\. script.sql</code> pour exécuter le script en argument\n<code class=\"language-text\">\\s</code> status du serveur\n<code class=\"language-text\">\\! cmd</code> execute une commande shell\n<code class=\"language-text\">\\T fichier.log</code> permet de spécifier un fichier dans lequel toute la session sera loggée</p>\n<h3>Historique</h3>\n<p>l'historique des commandes exécutée en mode interactif est conservé dans le fichier <code class=\"language-text\">.mysql_history</code> situé dans le home de l'utilisateur. Pour <a href=\"https://bugzilla.redhat.com/show_bug.cgi?id=1970829#c1\">info</a> ce fichier est encodé</p>\n<blockquote>\n<p>Please look at the \".mysql_history\" file as file with a binary format, managed by the MariaDB or MySQL application</p>\n</blockquote>\n<p><code class=\"language-text\">CTRL + R</code> nous permet de <strong>chercher dans l'historique</strong> des commandes passées.\nUne fois cette combinaison de touche entrée, on entre dans le <a href=\"%60CTRL+R%60\">mode <em>Recherche dans l'historique</em></a> de MySQL. La navigation s'effectue ensuite via <code class=\"language-text\">CTRL + R</code> (ancien) et <code class=\"language-text\">CTRL + S</code> (récent).</p>\n<h3>Exécution de script</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql db_name <span class=\"token operator\">&lt;</span> script<span class=\"token punctuation\">.</span><span class=\"token keyword\">sql</span> <span class=\"token operator\">></span> output<span class=\"token punctuation\">.</span>tab</code></pre></div>\n<p>voir toutes les <a href=\"https://mariadb.com/kb/en/mysql-command-line-client/#options\">options de la CLI mysql</a></p>\n<h3>Backup à la barbare</h3>\n<p>La carte micro-sd d'un de mes Raspberry Pie a laché, mais heureusement pour moi elle était encore lisible (mais dead en écriture).</p>\n<p>Le backup à la barbare consiste à récupérer le contenu du dossier <code class=\"language-text\">/var/lib/mysql</code> sur la carte cramée puis sur le nouveau serveur (ayant une installation de mariadb) :</p>\n<ul>\n<li>arreter l'instance de mariadb avec <code class=\"language-text\">sudo systemctl stop mariadb</code></li>\n<li>remplacer le dossier <code class=\"language-text\">/var/lib/mysql</code> local par celui de l'ancien serveur</li>\n<li>supprimer les ib_logfiles  <code class=\"language-text\">rm /var/lib/mysql/ib_logfile*</code>  sans quoi on aura des erreurs du type <code class=\"language-text\">[ERROR] Unknown/unsupported storage engine: InnoDB</code> lors de l'accès aux données</li>\n<li><code class=\"language-text\">sudo systemctl start mariadb</code></li>\n</ul>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://www.mysqltutorial.org/mysql-administration\">MySQLTutorial.org</a> site de tuto très clair 🌟 avec de nombreux exemples</li>\n<li><a href=\"https://dev.mysql.com/doc/\">MySQL docs</a></li>\n<li><a href=\"https://mariadb.com/kb/en/documentation/\">MariaDB docs</a> (pas très ergonomique cette doc 😵)</li>\n</ul>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}