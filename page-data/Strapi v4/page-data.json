{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/Strapi v4",
    "result": {"pageContext":{"id":"fc91ec42-0667-5f7c-9752-906a80d4c0d9","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/Strapi v4.md","frontmatter":{"categories":["cms"],"date":"2022-07-28","lastUpdate":"2022-07-28","tags":["strapi","headless cms","cms","api","graphql","rest","heroku","dyno","postgresql","sqlite","i18n"],"title":"Strapi v4"},"html":"<p><em>Draft</em></p>\n<h1>Présentation de Strapi</h1>\n<p><a href=\"https://docs.strapi.io/developer-docs/latest/getting-started/introduction.html\">Strapi</a> est un headless CMS <a href=\"https://github.com/strapi/strapi\">open source</a>, qui vient de <a href=\"https://techcrunch.com/2022/06/22/strapi-lands-31m-for-its-headless-cms-platform/\">lever 31M$ en série B</a> (est donc financièrement solide).\nC'est donc une solution de gestion de contenu qui permet de :</p>\n<ul>\n<li>générer/maintenir une base de données à travers une interface d'admin simple</li>\n<li><a href=\"https://strapi.io/features/internationalization\">i18n</a></li>\n<li><a href=\"https://strapi.io/features/media-library\">bibliothèque de medias</a></li>\n<li>d'accéder et modifier les données via des appels REST ou GraphQL branchés automatiquement 🎉</li>\n</ul>\n<p>Strapi représente un <strong>véritable gain de temps</strong> et permet de développer une app web ou mobile rapidement sans trop se soucier de la partie <em>back api/graphql</em>.\nDe nombreuses ressource sont disponible en ligne pour s'y mettre(<a href=\"https://www.youtube.com/watch?v=h9vETeRiulY\">intro de 3min</a> et <a href=\"https://www.youtube.com/watch?v=vcopLqUq594\">crash course d'1h</a>) mais une petite gymnastique mentale (et <a href=\"https://docs.strapi.io/developer-docs/latest/setup-deployment-guides/file-structure.html\">un peu de lecture RTFM</a> 🤪) est nécessaire pour comprendre son fonctionnement et surtout son intégration dans un projet web moderne.</p>\n<h2>Setup</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn create strapi-app mon-app-strapi</code></pre></div>\n<h2>Déploiement sur Heroku</h2>\n<p>Il est possible d’utiliser d'utiliser les plans gratuits (hobby) pour la dyno  de Heroku ainsi que la <a href=\"https://elements.heroku.com/addons/heroku-postgresql\">BDD</a>  <a href=\"https://devcenter.heroku.com/articles/heroku-postgresql\">Postgresql Heroku</a></p>\n<p>Pré-requis  :</p>\n<ul>\n<li><a href=\"https://www.github.com/\">Github Account</a></li>\n<li><a href=\"http://heroku.com/\">Heroku Account</a> &#x26; <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">heroku CLI</a></li>\n<li><a href=\"https://git-scm.com/\">Git</a> Installed on your machine</li>\n<li>Nodejs v16+ et utilisation de <code class=\"language-text\">Yarn</code></li>\n</ul>\n<h3>TLDR;</h3>\n<ol>\n<li>Créer une dyno (gratuite)</li>\n<li>la connecter au repo Git sur lequel on déploi Strapi</li>\n<li>activer le déploiement auto (restreindre ou pas déploiement selon succès de la CI)</li>\n<li>ajouter l'add-on Postgresql dans les Resources</li>\n<li>vérifier dans les Settings/Config Vars que la var d'env <code class=\"language-text\">DATABASE_URL</code> est bien renseigné auto</li>\n<li>créer <code class=\"language-text\">env/production/database.js</code> (voir ci-dessous)</li>\n<li>ajouter les var d'env Strapi</li>\n</ol>\n<p>Voir la doc Strapi complète pas à pas pour le <a href=\"https://strapi.io/blog/deploying-a-strapi-api-on-heroku\">déploiement de Strapi sur Heroku</a></p>\n<h3>Erreur Heroku 503</h3>\n<p>En tant que tel (site et BDD hébergés sur heroku hobby), nous allons rencontrer un problème de certificat SSL pour accéder à la BDD.</p>\n<blockquote>\n<p>2022-07-27T09:17:55.376140+00:00 heroku[router]: at=error <strong>code=H10</strong> desc=\"App crashed\" method=GET path=\"/\" host=qrmenuapi.herokuapp.com request_id=a3b7023d-9fa3-4067-aa33-effa6fca8ee3 fwd=\"176.151.81.254\" dyno= connect= service= <strong>status=503</strong> bytes= <strong>protocol=https</strong></p>\n</blockquote>\n<p>Cette <a href=\"https://forum.strapi.io/t/when-i-open-heroku-i-have-a-problem-with-strapi-with-h10-code/3734/3\">question</a> nous renseigne sur la modification à apporter à la config pour accepter les certificats autosignés de heroku et le fichier de  <code class=\"language-text\">config/env/production/database.js</code> ressemble a ça :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> parse <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pg-connection-string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DATABASE_URL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> env <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">connection</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">client</span><span class=\"token operator\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">connection</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">database</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">ssl</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">rejectUnauthorized</span><span class=\"token operator\">:</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">bool</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DATABASE_SSL_SELF'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// For self-signed certificates</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">ssl</span><span class=\"token operator\">:</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">bool</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DATABASE_SSL'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">debug</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Graphql</h1>\n<p>L'un des gros avantages de Strapi est qu'il nous mets à disposition une API REST ou GraphQL de façon très simple.</p>\n<p>L'interface de GraphiQl est accessible en local via <code class=\"language-text\">http://localhost:1337/graphql</code> mais nécessite une <strong>API Key</strong> pour autoriser les requêtes.\nIl faut la générer dans l'UI d'admin de Strapi > Settings et qui doit être injectée via Query Variable :<br>\n{bearer: \"66a8...3b97014\"}\nvia HTTP Headers :<br>\n{ \"Authorization\": \"Bearer \"66a8...3b97014\" }</p>\n<h1>i18n</h1>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">ingredients</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">data</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">attributes</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">label</span>\n        <span class=\"token property\">locale</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token property-query\">titreAccueilPizza</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"de\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">data</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">attributes</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">label</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>Plug-ins Strapi</h1>\n<p>Strapi peut être \"augmenté\" avec son sytème de Plugins</p>\n<ul>\n<li><a href=\"https://market.strapi.io/plugins/strapi-plugin-plausible?utm_campaign=strapi%20market&#x26;utm_source=email&#x26;utm_medium=logbook54&#x26;utm_content=strapiweekly\">Plausible</a> allows you to add an <strong>analytics</strong> dashboard to the Strapi admin so you can easily track the most relevant data.</li>\n<li><a href=\"https://market.strapi.io/plugins/@localazy-strapi-plugin?utm_campaign=strapi%20market&#x26;utm_source=email&#x26;utm_medium=logbook54&#x26;utm_content=strapiweekly\">Localazy</a> to <strong>manage your multilingual content</strong> with ease and translate it seamlessly. A must if your project is at different locations</li>\n<li><a href=\"https://market.strapi.io/plugins/@notum-cz-strapi-plugin-content-versioning\">Content Versioning</a> A Strapi plugin for managing versions of your content (<a href=\"https://strapi.io/blog/new-community-plugin-content-versioning\">why NOTUM tech built it</a>)</li>\n</ul>\n<h1>News</h1>\n<p>Avec l'arrivée de la version <a href=\"https://github.com/strapi/strapi/releases/tag/v4.3.0\">v4.3.0</a> Strapi supporte désormais <a href=\"https://docs.strapi.io/developer-docs/latest/development/typescript.html\">Typescript</a> (pour les developpements back \"Strapi\")\tet donne la possibilité de créer des dossier pour la gestion de médias 📁 <a href=\"https://www.youtube.com/watch?v=PimJ5Ogho28\">Media Library folders</a></p>\n<h1>Liens</h1>\n<p>Séries de cours sur <a href=\"app://obsidian.md/index.html#Youtube\">#Youtube</a> avec <a href=\"https://youtube.com/playlist?list=PL4cUxeGkcC9h6OY8_8Oq6JerWqsKdAPxn\">The Net Ninja</a></p>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}