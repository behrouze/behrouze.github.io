{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/npm","result":{"pageContext":{"id":"de4fdc68-5f15-5c64-b2d5-e98e72ede6e0","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/npm.md","frontmatter":{"categories":["javascript"],"date":"2018-11-01","lastUpdate":null,"tags":["nodejs","npm","nvm","node_modules"],"title":"npm"},"html":"<p>npm <em>Node Package Manager</em> est un gestionnaire de package Nodes qui permet aux dÃ©veloppeurs js (front ou back) dâ€™utiliser des outils souvent open source, sans avoir Ã  rÃ©inventer la roue Ã  chaque fois.</p>\n<p>A savoir que npm utilise le <a href=\"https://docs.npmjs.com/about-semantic-versioning\">semantic versioning</a>, que lâ€™on retrouve dans le package.json sous forme de numÃ©ros de versions <a href=\"https://docs.npmjs.com/about-semantic-versioning#using-semantic-versioning-to-specify-update-types-your-package-can-accept\">prÃ©cÃ©dÃ©s de ^ ou de ~</a> par ex.</p>\n<ul>\n<li>Patch releases:Â <code class=\"language-text\">1.0</code> ou <code class=\"language-text\">1.0.x</code> ou <code class=\"language-text\">~1.0.4</code></li>\n<li>Minor releases:Â <code class=\"language-text\">1</code> ou <code class=\"language-text\">1.x</code> ou <code class=\"language-text\">^1.0.4</code></li>\n<li>Major releases:Â <code class=\"language-text\">*</code> ou <code class=\"language-text\">x</code></li>\n</ul>\n<h1>Installation et usage basique</h1>\n<p>Pour pouvoir utiliser npm (ou yarn) il faut tout dâ€™abord installer NodeJs qui embarque <a href=\"https://docs.npmjs.com/cli-documentation/cli-commands\">npm</a> (voir <a href=\"http://raspi3/nvm-nodejs/\">nvm</a> pour plus de flexibilitÃ© sur les version de Node).</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token parameter variable\">-v</span>              <span class=\"token comment\"># version de npm</span>\n<span class=\"token function\">npm</span> i <span class=\"token punctuation\">[</span>-g<span class=\"token punctuation\">]</span> xxx      <span class=\"token comment\"># installer un package globalement (ex CLI)</span>\n<span class=\"token function\">npm</span> i xxx           <span class=\"token comment\"># installe le package xxx et mets Ã  jour le package.json</span>\n<span class=\"token function\">npm</span> i xxx@version   <span class=\"token comment\"># installe la version spÃ©cifiÃ©e</span>\n\n<span class=\"token function\">npm</span> <span class=\"token function\">ls</span> xxx    <span class=\"token comment\"># liste toutes les versions installÃ©es &amp; les dÃ©pendances du package xxx</span>\n<span class=\"token function\">npm</span> view xxx\n\n<span class=\"token function\">npm</span> <span class=\"token builtin class-name\">help</span> <span class=\"token punctuation\">[</span>command<span class=\"token punctuation\">]</span>  <span class=\"token comment\"># description de la commande et raccourcis</span>\n<span class=\"token function\">npm</span> i <span class=\"token function\">npm</span> <span class=\"token parameter variable\">-g</span>        <span class=\"token comment\"># pour mettre Ã  jour npm</span></code></pre></div>\n<h1>AvancÃ©</h1>\n<h2>IntÃ©gration Continue (ou CI)</h2>\n<p>Pour la ci (intÃ©gration continue) il est possible dâ€™utiliser <code class=\"language-text\">npm ci</code> plutÃ´t que <code class=\"language-text\">npm i</code>(<a href=\"https://stackoverflow.com/questions/52499617/what-is-the-difference-between-npm-install-and-npm-ci?answertab=votes#tab-top\">voici les diffÃ©rences</a>).</p>\n<p>Lâ€™interet dâ€™utiliser <code class=\"language-text\">npm ci</code> est quâ€™il va strictement respecter les numÃ©ros de versions prÃ©sents dans <code class=\"language-text\">package-lock.json</code> (qui doit exister) et supprime systÃ©matiquement le dossier <code class=\"language-text\">node_modules</code> pour rÃ©installer toutes les dÃ©pendances.</p>\n<h2>Mises Ã  jour de packages</h2>\n<p>Les <a href=\"https://docs.npmjs.com/cli/update\">mises Ã  jour des packages</a> sâ€™effectuent par la commande <code class=\"language-text\">npm update</code>, mais il existe des <a href=\"https://docs.npmjs.com/updating-packages-downloaded-from-the-registry\">commandes npm complÃ©mentaires</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> update xxx      <span class=\"token comment\"># mets Ã  jour le package selon les contraintes semver spÃ©cifiÃ©s dans le package.json</span>\n<span class=\"token function\">npm</span> update <span class=\"token punctuation\">[</span>--dev<span class=\"token punctuation\">]</span>  <span class=\"token comment\"># Attention: MAJ l'ensemble des packages desuets</span>\n<span class=\"token function\">npm</span> update <span class=\"token parameter variable\">-g</span> xxx\n\n<span class=\"token function\">npm</span> outdated        <span class=\"token comment\"># liste les packages dÃ©suets (Ã  mettre Ã  jour)</span>\n<span class=\"token function\">npm</span> outdated <span class=\"token parameter variable\">-g</span> <span class=\"token parameter variable\">--depth</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>   <span class=\"token comment\"># idem pour les packages installÃ©s globalements</span>\n\n<span class=\"token function\">npm</span> <span class=\"token function\">rm</span> xxx   <span class=\"token comment\"># supprime le package du projet</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 790px; box-shadow: 3px 5px 4px rgba(0,0,0,.1);margin:1rem;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a8fda9f20762b70551e8b085d720399/2e237/npm-outdated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.41784037558685%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABgklEQVQoz1WR6ZKqMBBGff83dMY7KosIRCEkkI3k3CLUqNNVXZX+c/Ith/5eItqatAZI7JMSKe1HjCtt12KtzXcjGmYz57d8SIZuoCgK+r4nxshBXX9QxQ9zXRGU5nO891hjeYgH2mhsNNxMw2Qnkk144ZiaidO/b47HI845DrqtkPUPui3x45ihQSmic6wx4qzNvy9mwUXHbWmY/UzyCdc7VK8piiuXyyULONiHwG0grQjThJeS6D0pxl//CCHels2dZTW7g6dDC019qynLkhACBzXekEOBWyZSiBmU/DvPLZe26zIwkajm6gV0YlOouGaF513hLG7I6oS+l6jbhe1epMAamYvZdhiGbHmbznTMYS8lyMB03zI88f31hfeOw6I6pKwIqyOlyBp93v1OufENaMyuqrf9B9Cjul3h+fyrUHZo1bLYgTUGYop/mt6gz+fwynADLmF5AefHTF1/ZGhGwdb0ZnkWDUt/J63rH+A4ji+Fwoo3UAV0r6nqirIoMvA/pk22HHnSDi0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3a8fda9f20762b70551e8b085d720399/bc663/npm-outdated.webp 213w,\n/static/3a8fda9f20762b70551e8b085d720399/8dc4f/npm-outdated.webp 425w,\n/static/3a8fda9f20762b70551e8b085d720399/02aff/npm-outdated.webp 790w\"\n              sizes=\"(max-width: 790px) 100vw, 790px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3a8fda9f20762b70551e8b085d720399/3cb16/npm-outdated.png 213w,\n/static/3a8fda9f20762b70551e8b085d720399/2fbbf/npm-outdated.png 425w,\n/static/3a8fda9f20762b70551e8b085d720399/2e237/npm-outdated.png 790w\"\n            sizes=\"(max-width: 790px) 100vw, 790px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3a8fda9f20762b70551e8b085d720399/2e237/npm-outdated.png\"\n            alt=\"npm outdated\"\n            title=\"npm outdated\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2>Mise Ã  jour de tous les packages ğŸ˜…</h2>\n<p>Depuis <code class=\"language-text\">npm</code> version 5.0.0, <code class=\"language-text\">npm update</code> met Ã  jour le fichier <code class=\"language-text\">package.json</code> avec les nouvelles versions niveau <em>mineur</em> ou <em>patch</em>.</p>\n<p>Il existe un outil <code class=\"language-text\">npm-check-updates</code>, qui nous permet de mettre Ã  jour (derniÃ¨re version) toutes les dÃ©pendances, mÃªme en version Majeur de notre <code class=\"language-text\">package.json</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> npm-check-updates\nnpm-check-updates <span class=\"token parameter variable\">-u</span> <span class=\"token comment\"># le -u pour Update, va mettre a jour le package.json</span>\n<span class=\"token function\">npm</span> i                <span class=\"token comment\"># ğŸ§¨ğŸ’¥ğŸ¤¯</span></code></pre></div>\n<p>voir <a href=\"npm-check-updates\">doc Node.js</a></p>\n<h1>Yarn</h1>\n<h2>Yarn 1 (dÃ©prÃ©ciÃ© depuis 2020)</h2>\n<p><code class=\"language-text\">yarn</code> est un autre package manager qui utilise les dÃ©pÃ´ts <code class=\"language-text\">npm</code>, qui dispose d'une <em>DX</em> plus intÃ©ressante et a toujours eu une longueur d'avance sur <code class=\"language-text\">npm</code> pour la gestion du cache et la vitesse</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token parameter variable\">-g</span> <span class=\"token function\">yarn</span> <span class=\"token comment\"># installer ou mettre Ã  jour Yarn</span>\n<span class=\"token function\">yarn</span> up XXX <span class=\"token parameter variable\">--latest</span>  \n<span class=\"token function\">yarn</span> up <span class=\"token parameter variable\">--interactive</span> <span class=\"token parameter variable\">--latest</span>  <span class=\"token comment\"># UI permettant de sÃ©lectionner les packages Ã  MAJ</span>\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> xxx --network-timeout <span class=\"token number\">100000</span> <span class=\"token comment\"># en cas de message \"npm info There appears to be trouble with your network connection\"</span></code></pre></div>\n<h2>Yarn 2</h2>\n<p>Depuis <strong>Node 16.10.0</strong> yarn est une fonctionnalitÃ© qu'il faut activer dans NodeJs, voir <a href=\"cheat-sheets\">cheat sheets</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">corepack <span class=\"token builtin class-name\">enable</span>\n<span class=\"token function\">yarn</span> <span class=\"token builtin class-name\">set</span> version stable</code></pre></div>\n<h1>Divers</h1>\n<p>package <a href=\"https://www.npmjs.com/package/rsyslog\">npm rsyslog</a> pour les dev NodeJs</p>\n<ul>\n<li>detect-browsers <a href=\"https://github.com/DamonOehlman/detect-browser#detect-browser\">ğŸ”—</a> <a href=\"https://bundlephobia.com/result?p=detect-browser@4.6.0\">âš–</a></li>\n</ul>\n<h1>plugins Babel</h1>\n<p>babel-plugin-root-import : permet dâ€™importer en partant de la racine du projet avec un ~ ce qui Ã©vite les ../../.. ğŸ˜… ou une <a href=\"https://moduscreate.com/blog/es6-es2015-import-no-relative-path-webpack/\">solution alternative</a> avec Webpack >2 (<a href=\"http://whoisryosuke.com/blog/2018/nextjs-tip-relative-es6-modules/\">conf NextJs</a>)</p>\n<h1>VidÃ©os</h1>\n<p>npm inc mets Ã  disposition un tas de <a href=\"https://www.youtube.com/channel/UCK71Wk0I45SLTSXQA23GdIw/videos\">vidÃ©os</a> trÃ¨s clair Ã  propos des commandes et concepts autour de npm ainsi que des confÃ©rences:</p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?time_continue=1&#x26;v=kK4Meix58R4&#x26;feature=emb_logo\">Semantic Versioning</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=HRudtPGcOt4&#x26;feature=emb_logo\">npm update</a></li>\n</ul>"}},"staticQueryHashes":["1026020893","28434099","3153813225"]}