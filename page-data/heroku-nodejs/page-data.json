{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/heroku-nodejs",
    "result": {"pageContext":{"id":"bc818b8a-9376-56ea-a8b9-44291e324fb2","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/heroku-nodejs.md","frontmatter":{"categories":["devops"],"date":"2018-10-23","lastUpdate":null,"tags":["devops","git","linux","nodejs"],"title":"Heroku"},"html":"<h1><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3676fb5059ec0794183140f253579968/5a46d/heroku-logotype-horizontal-purple-300x127.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.25352112676056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABzElEQVQozz2SS2uTQRSGn0m0RnoxJo02tWq1zaXGhaIpmtTLHLSmahJroUiqIF4RBHfB1oWLUGsXIpjvm9m487IQxKq40I0Lf0G3/plPZoweOMx53znnnTkzh0H2KoAGGzT4TJOv3p2lOKQSpEgxpQbZT5IcCdJ+3c4wjusnSz+jgJeBiIhpVrZqupOaoKDpFl1c4lY8S1WNc7GXCWkOq32c97jE7ViCYSDGKDNKEfub1OALZ3m1WzBXNeEJTVgRTOM0L3Zc4A3zfOc47XiRlmryjXl+MMWSqvGWFpv+Qgv89FquG+psOMGMYC4Jdk0wi5qwpAnygm0LdkmwDwWzINiOYOqCfSDYe4K9K5iaYFon6fS9Jvon2B0RzClNWBbMfcHMaoIJwQaCfSTYVcHe6eEbgn0q2GXBPunxnUV+keGIYo73aIKsYJua8KBgzgnm2hleDtV4xwoRM6xvK/M47loeZ0457OqcVXm2pcJq/DqbjKFhnYgqz/s0YV4Ii0JY0IS5MstxVzDAHm7ymw9EZKko92YOT3DFf84aEe3enj8hSd4nuZGp84nLfPTubIRpNcAYuzimkuTUTgpqiAMqw1HHqySTnk9T+j8JfwAn8Huqmk28LAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"heroku logotype horizontal purple 300x127\"\n        title=\"heroku logotype horizontal purple 300x127\"\n        src=\"/static/3676fb5059ec0794183140f253579968/5a46d/heroku-logotype-horizontal-purple-300x127.png\"\n        srcset=\"/static/3676fb5059ec0794183140f253579968/3cb16/heroku-logotype-horizontal-purple-300x127.png 213w,\n/static/3676fb5059ec0794183140f253579968/5a46d/heroku-logotype-horizontal-purple-300x127.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></h1>\n<p><strong>Heroku</strong> est un Paas (service en ligne)  qui nous permet de <strong>déployer, gérer et faire tourner</strong> des <strong>applications</strong> (Node.js, Python, Go, Scala, Ruby, Clojure, Java et PHP) sur des containers <strong>Linux</strong> appelés <a href=\"https://devcenter.heroku.com/articles/dynos\"><strong>dynos</strong></a> (infrastructure Heroku) et offre un <a href=\"https://dashboard.heroku.com\">Dashboard d'administration</a> plutôt bien fait.</p>\n<p>Une <strong>application au sens Heroku</strong> est un <strong>ensemble de fichiers source</strong> ainsi qu'un <strong>fichier de dépendances</strong> (package.json pour du Node) et un <strong><a href=\"https://devcenter.heroku.com/articles/procfile\">Procfile</a></strong> (qui défini les commandes pour lancers les différentes instances des composants de votre application).</p>\n<p>La <strong>méthode de déploiement</strong> préconisée sur l'infra Heroku est <strong>Git</strong> bien qu'il soit possible d'utiliser leurs <a href=\"https://devcenter.heroku.com/articles/build-and-release-using-the-api\">API</a> ou l'<a href=\"https://devcenter.heroku.com/articles/github-integration\">intégration GitHub</a>.</p>\n<h2>Terminologie</h2>\n<ul>\n<li>les <strong><a href=\"https://devcenter.heroku.com/articles/dynos\">Dynos</a></strong> sont des <strong>containers Unix virtualisés isolés</strong>, qui fournissent l'environnement requis pour lancer une application</li>\n<li>un <strong><a href=\"https://devcenter.heroku.com/articles/slug-compiler\">Slug</a></strong> est une <strong>archive compressée</strong> regroupant les <strong>sources</strong>, les <strong>dépendances</strong>, le <strong>runtime</strong> et les éléments <strong>compilés</strong> par le système de build</li>\n</ul>\n<h2>Fonctionnement</h2>\n<h3>Pré requis</h3>\n<p>Pour déployer une <em>application NodeJs sur Heroku</em>, il faut disposer en local de :</p>\n<ol>\n<li><strong>Nodejs</strong> et <strong>npm</strong></li>\n<li>client <strong>git</strong></li>\n<li>\nCLI Heroku (installer sous Windows via <a href=\"/chocolatey\" title=\"chocolatey\">chocolatey</a> : choco install heroku-cli /y ou sous linux avec snap : sudo snap install heroku --classic )\n</li>\n<li><em>un compte</em> sur <a href=\"https://signup.heroku.com/dc\">Heroku.com</a></li>\n</ol>\n<h3>Déploiement</h3>\n<p>Exécuter les commandes suivantes une fois un nouveau shell ouvert dans le dossier de votre projet:</p>\n<p>heroku login # demande les login/pass de votre compte heroku.com\nheroku create nomDeVotreAppli --region eu # cré un projet nomDeVotreAppli sur heroku.com &#x26; le git remote associé nommé heroku\ngit push heroku master # déploie les sources et lance le process de Build sur heroku.com</p>\n<h3>Vie de la dyno</h3>\n<p>Il est possible de surveiller l'état de nos dynos grâces aux commandes suivantes :</p>\n<p>heroku info # liste toutes les caractéristiques de la dyno\nheroku logs --tail # suit les logs (équivalent à un tail -f en bash)\nheroku ps # affiche le nombre et l'état des dynos (runnig, crash etc)\nheroku ps:scale web=3 # augmente le nombre de dynos pour cette instance à 3\nheroku open # ouvre l'URL de votre appli hébergé dans votre Navigateur !\nheroku git:clone -a nomDeVotreAppli # récupère les sources du code déployé</p>\n<p>Pour <strong>lancer l'appli web en local</strong> et vérifier notre <strong>procfile</strong>, heroku nous propose la commande : heroku local web</p>\n<p>Nous avons également la possibilité d'accéder à un shell sur notre instance via la commande : heroku run bash</p>\n<h3>RAM</h3>\n<p>La mémoire étant limitée (surtout pour les plans gratuit et hobbie 512Mo) il faut pouvoir surveiller la <a href=\"https://devcenter.heroku.com/articles/optimizing-dyno-usage#measuring\">consommation mémoire</a> de sa dyno, il est possible d'utiliser une <a href=\"https://devcenter.heroku.com/categories/labs\">Heroku Lab</a> (fonctionnalité expérimentale) qui est le log-runtime-metrics, qui comme son nom l'indique va logger visible dans PaperTrail ou les logs heroku la consommation mémoire :</p>\n<p>heroku labs:enable log-runtime-metrics # installe la fonctionnalité\nheroku labs:disable log-runtime-metrics # commande pour la désinstaller\nheroku restart</p>\n<h2>Variables d'environnements</h2>\n<h3>Local</h3>\n<p>En <strong>local</strong>, heroku nous mets à disposition le <a href=\"https://devcenter.heroku.com/articles/heroku-local#set-up-your-local-environment-variables\"><strong>fichier .env</strong></a> pour y positionner les variables d'environnement souhaités.</p>\n<h3><strong>Sur notre dynos</strong></h3>\n<p>Un set de commandes dédiés aux créations/suppressions de variables d'environnement sont disponibles pour nos instances Heroku :</p>\n<p>heroku config:set NODE_ENV=\"production\" # pour setter la variable d'environnement NODE_ENV\nheroku config # visualiser les variables d'environnement de la dyno\n#=== monApp Config Vars\n#NODE_ENV: production\n#NODE_PORT: 8080\n#PAPERTRAIL_API_TOKEN: xxxxxxxxxxxxxxx\nheroku config:unset NODE_PORT # pour supprimer la variable</p>\n<h2>Addons</h2>\n<p>Heroku propose un système d'<a href=\"https://elements.heroku.com/addons\">add-ons</a>, permettant d'outiller notre environnement, avec par exemple un <a href=\"https://devcenter.heroku.com/articles/papertrail\">PaperTrail</a> :</p>\n<p>heroku addons:create papertrail # ajoute l'addon PaperTrail\nheroku addons # liste les addons 'installés' sur notre dyno\nheroku addons:open papertrail # ouvre la page web de Papertrail</p>\n<p>Les addons installés sont également accessible aussi depuis l'onglet resources de notre dyno.</p>\n<h2>Addons intéressants</h2>\n<p><a href=\"https://devcenter.heroku.com/articles/papertrail\">PaperTrail</a> : centralise les logs de nos différentes dynos ou apps et propose une WebUI permettant de filtrer les évenements</p>\n<p><a href=\"https://elements.heroku.com/addons/librato\">Librato</a> : permet de monitorer vos dynos et propose une interface sympa</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db53b357c1d0b264959b73dec88973d8/33a7b/Heroku-Addon-Librato.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.62910798122066%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADAklEQVQ4y11STWsVZxSeH9E/4MIf0FU3QgXNXBGrVrGLWsSNWNqKaRIoKHTlzjR3YQSprgShi4Ah1rQEjf1IrNKqJNUL10UpBReNmnvnfWfe7/d9yjl3Zrz2hcOZOd/POU925MPzOPbR1+jkM+h0ZtDJp5FPTCPfM4n8/S+Q7z7TysHONA5MfIkD+RQ+yKf4+9C+GXTIt28axw5/hey366v44/oK1q7cxv2ry1j/9gf8Mr+Ete8e4N6tZ1hd3MTdxU3cW3qKX5f7WFvu4+fve1hd/BN3b27izs0N/LT0DOs/PsfG/X+QVRfPQZw9DnH6CIbHJzD4eC+2D70HvXQDEUAIGhEeb78EHw1CsvT1lid7/PlJPNy/C4+O5ljfvwur7+7Ays538Ne1yxwQfUCKCcp6vBIKUlt47xFjYjvpLaGwLRVKbZH1Zi/g8WcnsDF5Co8mT+HJ1Gn8/ukneLFym3urqoI1Bi8LiW1RQlQKzjk4Z2GMhjEG/w4FXosSUmlkhZQgKZVCSAmJAQHOexRFgeGw4KQR0sSijcGrQYGt1wMorVtfShFZCB6pDgRBcR4pBMQYWcgXvIejhs4hxgAfAlyICAQ5JRgf4UPk74ySQgg8vhQCQhTcNdRFSdNEsqogqxLamtYeKc9ahloqzavIZCkhhIBSCpZ343jp1louLqXkfxIqYq1BVVUQUmIwLKCpee0nycjgGEp8Q4oETqYmFNQ8gqStRaUUikqj0qNpee+URLQZr1JZA1kXGW/Q7FJbB2NdmzzOS+NGOTwhQSBNE0kpoNWIGmQry5K1MRbaKFSq5DjaszMaf29t48VAwlkDpc2o4P+h0fPecSMSgk/POMdUop2P4hPzT2hTg0zImvFp3AbqOGWA0T75UM5yAxqg8Xvn+CiReThGm/aS9TXDGBdbmtR7pcTRAKGNbYbJGliqUtyZLtjYiDLD4ZBhFoWodcF7bWLa/Dova4LGhYqQc2FhAd1uF/OX5jHX/QZz3TnMXpxFr9fjAoPBoI2nJv1+H/8BAX/ch4gG+nUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Heroku Addon Librato\"\n        title=\"Heroku Addon Librato\"\n        src=\"/static/db53b357c1d0b264959b73dec88973d8/ae694/Heroku-Addon-Librato.png\"\n        srcset=\"/static/db53b357c1d0b264959b73dec88973d8/3cb16/Heroku-Addon-Librato.png 213w,\n/static/db53b357c1d0b264959b73dec88973d8/2fbbf/Heroku-Addon-Librato.png 425w,\n/static/db53b357c1d0b264959b73dec88973d8/ae694/Heroku-Addon-Librato.png 850w,\n/static/db53b357c1d0b264959b73dec88973d8/33a7b/Heroku-Addon-Librato.png 1119w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://devcenter.heroku.com/articles/how-heroku-works\">Définitions et aperçu technique du fonctionnement de Heroku</a></li>\n<li><a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs\">Tuto Heroku NodeJs</a></li>\n<li>Un comparatif entre <a href=\"https://tuhrig.de/docker-vs-heroku/\">Docker et Heroku</a></li>\n</ul>"}},
    "staticQueryHashes": ["1026020893","1333896537","28434099"]}