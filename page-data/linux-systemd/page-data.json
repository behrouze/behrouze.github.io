{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/linux-systemd",
    "result": {"pageContext":{"id":"cfba85d4-e489-5d98-a93b-72c1176f80cc","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/linux-systemd.md","frontmatter":{"categories":["linux"],"date":"2019-03-25","lastUpdate":"2022-03-11","tags":["journalctl","linux","service","systemctl","systemd","init"],"title":"Linux systemd"},"html":"<h1>Systemd, les services syst√®mes sous Linux</h1>\n<p><a href=\"https://freedesktop.org/wiki/Software/systemd/\">Systemd</a> successeur de System V, fourni un <em>syst√®me/service manager</em> qui est lanc√© avec le <code class=\"language-text\">PID 1</code> (l'init daemon) et d√©marre le reste du syst√®me, mais fourni √©galement un nombre impressionnant d‚Äôoutils (avec ses <a href=\"https://www.reddit.com/r/linux/comments/bsqar4/you_probably_hate_systemd_because_you_think_its/?utm_medium=android_app&#x26;utm_source=share\">pros</a> &#x26; cons).\nSystemd n'est donc pas qu'un <em>init system</em>, mais bien un ensemble de services.</p>\n<blockquote>\n<p><strong>Systemd</strong> est un gestionnaire de syst√®mes et de services pour les syst√®mes d'exploitation Linux. Il est con√ßu pour √™tre r√©tro-compatible avec les scripts SysV init, et fournit un certain nombre de fonctionnalit√©s, comme le lancement en parall√®le des services syst√®me pendant l'initialisation, l'activation des d√©mons √† la demande, la prise en charge des instantan√©s d'√©tat du syst√®me, ou la logique de contr√¥le de service bas√©e sur d√©pendances.</p>\n</blockquote>\n<p>- <a href=\"https://access.redhat.com/documentation/fr-fr/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd\">RedHat</a></p>\n<blockquote>\n<p>systemd is a system and service manager for Linux operating systems. When run as first process on boot (as PID 1), it acts as init system that brings up and maintains userspace services. Separate instances are started for logged-in users to start their services.</p>\n</blockquote>\n<p>- man systemd</p>\n<h2>Les commandes de gestion principales</h2>\n<p>Les commandes suivantes permettent de gerer les diff√©rents composants de systemd :\n<code class=\"language-text\">systemctl</code>: permet d'envoyer des commandes a systemd (manager)\n<code class=\"language-text\">journalctl</code>: journal centralis√© de systemd (et donc des services)\n<code class=\"language-text\">timedatectl</code>: date/heure du serveur\n<code class=\"language-text\">hostnamectl</code>: nom de la machine\n<code class=\"language-text\">localectl</code>: configuration des locales et du clavier\n<code class=\"language-text\">loginctl</code>: login manager</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; box-shadow: 3px 5px 4px rgba(0,0,0,.1);margin:1rem;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.441314553990615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADt0lEQVQozzWO/1PadRzH3556tq7rp931Q3X1Q6tZ3qysxTY0W+5y0+nZqeCHj4wPKggOkIGCAYJ6k0kb2Jho6kAEQeUDHz6AsvQkt5xfSlyzL5/y2l/Q9Utdszp7v7p51/Pu+dvjHs8nyi848qInC0g6lAprxzfgmDoJiIj9Vt8fr1XdyvxJutZwnigCz7YkPlW7ksOd4xtQqGH/zWma//ucOXn8Lf0iKlLROej/5OUXHMvCoTCondiE11RxnE9Gf220RWtUtzJ/NDvvHjxFzsPRVtahdiZdT0bfUDP/5BPhx5Um5vi7OgYVq+ZyJJLrSKGYQOjocy+/4PsdUJtzOaHzZuEV5Twg4cx+dV/somZ8AwjXXcgTTMHTZOCGamTZ3endhtfVMShoCsFHRqboeasPVUqn8kjRci4lWc99cjJXpg2hDnrxpR7fveq2TlZRKg029NR2Fxt6/VJn/5K+kpppp+TTbwZvrLztHF6VC7Q0iQTeMx3PLCKh5GtECNyIFC0jqXQDoV7z8oBOF7M31EyYpIJZg6014tQ1BN02ZWJSWedz9Ylj03ZZdETdGPJY2xOj2ka/u5tiDJ7BTVJCeIeo5nmzWhFSSkjvkLwlakVdPV+AoScDjeItkCiz0KxYgwbqOxAr7wEhewCilk1oVnwFQukuiNtXoVm+DWL5g7+05vuPLrXfhzbN3mORjPlZptkGueZ7QGm7d9atucbSwq54gC+Mh8+SrJ8vYucqxInpUhEzWXc5E77QuhCqlMdZQsfO1qoT9Mdq+k69LBgoI5NBPkEzZ+sD/lIy6S8jw2itvwcsLZWwVFcLbNGrsMTnAftOMSyUFMOdMychVXMeVs6VQ/r904fNnK+AdDkf0vzTh1zkRCGkTpYAc6LwkEfrU6OwsbuFdR+U4xEeD8clEjz8YQUeLSvDbGsbvs3j4WRTEx6/WIOdJSU4IhZj53s8fLuqCocIAn926hSmKQqHq6pwSigE9NBfd7DOOGDVcgF/22WCrKEbvtHrYVung7RCAUmKgpRMBisdlyF75Qrsmi2wpdXCttEImyYTpDUa2OnrwzsWCzy02Q5Q7HPnzpzb8dOXkeCPY1cHuNj4KJehw9xNq4ULeW5ybMDHDXbruLhvgkvP+DmXycgthQPcYnCau2brf+SwO/au2/p+GTB8smfSdv2A6ER0n1mMQ2yBwdarVvBMeiCaioJar4Ex7xjQiQgYLUaYCk1BiJ6BbrMBZiJB8M+HwTxoB4vdAXpLL26k2qBaQOz/B60dESRO8RFzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/bc663/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 213w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/8dc4f/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 425w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/10237/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 850w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/92f8c/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 1200w\"\n              sizes=\"(max-width: 850px) 100vw, 850px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/3cb16/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 213w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/2fbbf/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 425w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/ae694/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 850w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/c1b63/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 1200w\"\n            sizes=\"(max-width: 850px) 100vw, 850px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/ae694/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png\"\n            alt=\"interfaces de Noyau Linux, unified hierarchy cgroups et systemd\"\n            title=\"interfaces de Noyau Linux, unified hierarchy cgroups et systemd\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<a href=\"https://commons.wikimedia.org/wiki/File:Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg\">source</a></p>\n<h1>systemctl</h1>\n<p>Pour <strong>g√©rer les services</strong> (<code class=\"language-text\">start</code>, <code class=\"language-text\">stop</code>, <code class=\"language-text\">restart</code>, <code class=\"language-text\">status</code>) sur un syst√®me Linux disposant de <code class=\"language-text\">systemd</code>, nous pouvons utiliser la commande <code class=\"language-text\">systemctl</code> (anciennement <code class=\"language-text\">service</code>).</p>\n<p>Ces services sont <em>cr√©√©s/param√©tr√©s</em> via des <em>fichiers de configuration</em> se trouvant dans <code class=\"language-text\">/etc/systemd/system/</code> et il est possible de <a href=\"https://doc.ubuntu-fr.org/creer_un_service_avec_systemd\">cr√©er simplement soi-m√™me des services</a> pour lancer par ex une application web au d√©marrage du syst√®me.</p>\n<p><code class=\"language-text\">systemctl enable monservice.service</code> : active (<code class=\"language-text\">enable</code>) ou d√©sactive (<code class=\"language-text\">disable</code>) le service pour un <strong>d√©marrage auto au boot de la machine</strong>.<br>\nIl existe ensuite un ensemble de param√®tres permettant d‚Äôinteragir interactivement avec nos services.</p>\n<p><code class=\"language-text\">systemctl status</code> : donne sous forme d‚Äô<strong>arborescence</strong> la liste des <strong>services d√©marr√©s</strong>, et l‚Äô√©tat global (running : tout va bien, degraded : un ou pls services sont en carafe)</p>\n<p><code class=\"language-text\">systemctl status nom-du-service</code> : donne l‚Äô√©tat du service et ses options/infos de d√©marrage (il est possible d‚Äôomettre l‚Äôextension .service dans le nom du service)</p>\n<p><code class=\"language-text\">systemctl list-unit-files</code> : liste l‚Äô<strong>ensemble des services install√©s</strong> et leurs <strong>status</strong> (static | enabled | disabled | masked)</p>\n<p><code class=\"language-text\">systemctl list-units --failed</code> : liste les <strong>services en √©chec</strong></p>\n<p><code class=\"language-text\">systemctl -p LogLevel show</code> : affiche le <strong>LogLevel de systemd</strong>, <em>info</em> par d√©faut (qui peut polluer les logs rsyslog)</p>\n<p><code class=\"language-text\">systemd-analyze set-log-level notice</code> : permet de <strong>modifier le LogLevel de systemd</strong> <strong>temporairement</strong> (jusqu‚Äôau prochain reboot)</p>\n<p><code class=\"language-text\">systemctl daemon-reexec</code> : red√©marrage du <strong>service systemctl</strong> (sans rebooter)</p>\n<p><code class=\"language-text\">systemctl daemon-reload</code> : *<em>apr√®s avoir modifi√© un fichier <em>.service</em></em> de d√©finition de service (/etc/systemd/system/) il faut recharger systemctl avec cette commande avant de pourvoir r√©-interagir avec</p>\n<h2>Liste des commandes systemctl</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">systemctl status <span class=\"token comment\"># arborescence</span>\nsystemctl list-units --failed <span class=\"token comment\"># services en √©chec</span>\nsystemctl status nom-du-service <span class=\"token comment\"># √©tat du service et ses options/infos de d√©marrage</span>\nsystemctl list-unit-files <span class=\"token comment\"># ensemble des services install√©s et leurs status </span>\nsystemctl -p LogLevel show <span class=\"token comment\"># affiche le LogLevel de systemd</span>\nsystemd-analyze set-log-level notice <span class=\"token comment\"># modifier le LogLevel jusqu'au prochain reboot</span>\nsystemctl daemon-reexec <span class=\"token comment\"># red√©marrage du service systemctl (sans rebooter)</span></code></pre></div>\n<h1>journalctl</h1>\n<p>Les services g√©r√©s par <strong>systemd</strong> ont leurs logs accessible par d√©faut (souvent param√©trable) via la commande <code class=\"language-text\">journalctl</code> utile pour voir les logs des services en √©chec (option <code class=\"language-text\">-f</code> pour follow)</p>\n<p>Pour lister les entr√©es du journal d‚Äôaujourd‚Äôhui <strong>sp√©cifique au service sp√©cifi√©</strong> par l‚Äôoption <code class=\"language-text\">-u</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl -u nginx.service         <span class=\"token comment\"># filtrer par nom de service</span>\njournalctl -f                       <span class=\"token comment\"># follow</span>\njournalctl -n <span class=\"token number\">50</span>                    <span class=\"token comment\"># nombre de lignes</span>\njournalctl --since today\njournalctl --since <span class=\"token string\">\"3 hours ago\"</span>\njournalctl --since <span class=\"token string\">\"3 days ago\"</span></code></pre></div>\n<h2>Gestion du journal</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl --verify\njournalctl --disk-usage</code></pre></div>\n<h2>Vider le journal</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl --vacuum-time<span class=\"token operator\">=</span>2d\njournalctl --vacuum-size<span class=\"token operator\">=</span>500M</code></pre></div>\n<h1>timedatectl</h1>\n<p>la commande <code class=\"language-text\">timedatectl</code> qui permet de lire et modifier la date/heure/fuseau horaire :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> timedatectl\n<span class=\"token function\">sudo</span> timedatectl list-timezones\n<span class=\"token function\">sudo</span> timedatectl set-timezone Europe/Paris</code></pre></div>\n<h1>Binaires</h1>\n<p>Voici par exemple la liste des binaires systemd pr√©sents sur un syst√®me <a href=\"https://www.raspberrypi.com/documentation/computers/os.html\">Raspberry Pi OS</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">bluetoothctl\nbootctl\nbusctl\ncec-ctl\ncx18-ctl\nhostnamectl  <span class=\"token operator\">&lt;=</span>\nir-ctl\nivtv-ctl\njournalctl   <span class=\"token operator\">&lt;=</span>\nkeyctl\nlocalectl    <span class=\"token operator\">&lt;=</span>\nloginctl     <span class=\"token operator\">&lt;=</span>\nmedia-ctl\nnetworkctl   <span class=\"token operator\">&lt;=</span>\nobexctl\nrds-ctl\nresolvectl   <span class=\"token operator\">&lt;=</span>\nsystemctl    <span class=\"token operator\">&lt;=</span>\ntimedatectl  <span class=\"token operator\">&lt;=</span>\nudisksctl\nv4l2-ctl\nwdctl</code></pre></div>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://linuxfr.org/news/evolutions-techniques-de-systemd\">√âvolutions techniques de systemd</a> sur linuxfr.org üëç et interview de son cr√©ateur <a href=\"https://linuxfr.org/news/un-entretien-avec-lennart-poettering\">Lennart Poettering</a></li>\n<li><a href=\"https://fr.wikipedia.org/wiki/Systemd#Concept\">Conceptes</a> - wikipedia</li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units\">How to use Systemctl</a></li>\n<li>Configurer un <a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples\">red√©marrage de service au reboot et apr√®s un crash</a></li>\n<li><a href=\"https://wiki.archlinux.org/title/Systemd_(Fran%C3%A7ais)\">systemd</a> de l'ArchWiki</li>\n</ul>\n<h2>Videos</h2>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=NNgZXNQtil8\">We Need to Talk About Systemd</a>: Boot Time Optimization for the New init daemon - Chris Simmonds, 2net</li>\n<li><a href=\"https://www.youtube.com/watch?v=hc7J-zWEty8\">Why Systemd is the Devil but I Love It</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=y3NYrC5RiRo\">Systemd Is Hated By Many, But Does It Deserve It?</a></li>\n</ul>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}