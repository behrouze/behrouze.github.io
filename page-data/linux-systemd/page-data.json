{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/linux-systemd",
    "result": {"pageContext":{"id":"cfba85d4-e489-5d98-a93b-72c1176f80cc","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/linux-systemd.md","frontmatter":{"categories":["linux"],"date":"2019-03-25","lastUpdate":"2022-03-11","tags":["journalctl","linux","service","systemctl","systemd","init"],"title":"Linux systemd"},"html":"<h1>Systemd, les services systèmes sous Linux</h1>\n<p><a href=\"https://freedesktop.org/wiki/Software/systemd/\">Systemd</a> successeur de System V, fourni un <em>système/service manager</em> qui est lancé avec le <code class=\"language-text\">PID 1</code> (l'init daemon) et démarre le reste du système, mais fourni également un nombre impressionnant d’outils (avec ses <a href=\"https://www.reddit.com/r/linux/comments/bsqar4/you_probably_hate_systemd_because_you_think_its/?utm_medium=android_app&#x26;utm_source=share\">pros</a> &#x26; cons).\nSystemd n'est donc pas qu'un <em>init system</em>, mais bien un ensemble de services.</p>\n<blockquote>\n<p><strong>Systemd</strong> est un gestionnaire de systèmes et de services pour les systèmes d'exploitation Linux. Il est conçu pour être rétro-compatible avec les scripts SysV init, et fournit un certain nombre de fonctionnalités, comme le lancement en parallèle des services système pendant l'initialisation, l'activation des démons à la demande, la prise en charge des instantanés d'état du système, ou la logique de contrôle de service basée sur dépendances.</p>\n</blockquote>\n<p>- <a href=\"https://access.redhat.com/documentation/fr-fr/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd\">RedHat</a></p>\n<blockquote>\n<p>systemd is a system and service manager for Linux operating systems. When run as first process on boot (as PID 1), it acts as init system that brings up and maintains userspace services. Separate instances are started for logged-in users to start their services.</p>\n</blockquote>\n<p>- man systemd</p>\n<h2>Les commandes de gestion principales</h2>\n<p>Les commandes suivantes permettent de gerer les différents composants de systemd :</p>\n<ul>\n<li><code class=\"language-text\">systemctl</code>: permet d'envoyer des commandes a systemd (manager)</li>\n<li><code class=\"language-text\">journalctl</code>: journal centralisé de systemd (et donc des services)</li>\n<li><code class=\"language-text\">timedatectl</code>: date/heure du serveur</li>\n<li><code class=\"language-text\">hostnamectl</code>: nom de la machine</li>\n<li><code class=\"language-text\">localectl</code>: configuration des locales et du clavier</li>\n<li><code class=\"language-text\">loginctl</code>: login manager</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; box-shadow: 3px 5px 4px rgba(0,0,0,.1);margin:1rem;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.441314553990615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADt0lEQVQozzWO/1PadRzH3556tq7rp931Q3X1Q6tZ3qysxTY0W+5y0+nZqeCHj4wPKggOkIGCAYJ6k0kb2Jho6kAEQeUDHz6AsvQkt5xfSlyzL5/y2l/Q9Utdszp7v7p51/Pu+dvjHs8nyi848qInC0g6lAprxzfgmDoJiIj9Vt8fr1XdyvxJutZwnigCz7YkPlW7ksOd4xtQqGH/zWma//ucOXn8Lf0iKlLROej/5OUXHMvCoTCondiE11RxnE9Gf220RWtUtzJ/NDvvHjxFzsPRVtahdiZdT0bfUDP/5BPhx5Um5vi7OgYVq+ZyJJLrSKGYQOjocy+/4PsdUJtzOaHzZuEV5Twg4cx+dV/somZ8AwjXXcgTTMHTZOCGamTZ3endhtfVMShoCsFHRqboeasPVUqn8kjRci4lWc99cjJXpg2hDnrxpR7fveq2TlZRKg029NR2Fxt6/VJn/5K+kpppp+TTbwZvrLztHF6VC7Q0iQTeMx3PLCKh5GtECNyIFC0jqXQDoV7z8oBOF7M31EyYpIJZg6014tQ1BN02ZWJSWedz9Ylj03ZZdETdGPJY2xOj2ka/u5tiDJ7BTVJCeIeo5nmzWhFSSkjvkLwlakVdPV+AoScDjeItkCiz0KxYgwbqOxAr7wEhewCilk1oVnwFQukuiNtXoVm+DWL5g7+05vuPLrXfhzbN3mORjPlZptkGueZ7QGm7d9atucbSwq54gC+Mh8+SrJ8vYucqxInpUhEzWXc5E77QuhCqlMdZQsfO1qoT9Mdq+k69LBgoI5NBPkEzZ+sD/lIy6S8jw2itvwcsLZWwVFcLbNGrsMTnAftOMSyUFMOdMychVXMeVs6VQ/r904fNnK+AdDkf0vzTh1zkRCGkTpYAc6LwkEfrU6OwsbuFdR+U4xEeD8clEjz8YQUeLSvDbGsbvs3j4WRTEx6/WIOdJSU4IhZj53s8fLuqCocIAn926hSmKQqHq6pwSigE9NBfd7DOOGDVcgF/22WCrKEbvtHrYVung7RCAUmKgpRMBisdlyF75Qrsmi2wpdXCttEImyYTpDUa2OnrwzsWCzy02Q5Q7HPnzpzb8dOXkeCPY1cHuNj4KJehw9xNq4ULeW5ybMDHDXbruLhvgkvP+DmXycgthQPcYnCau2brf+SwO/au2/p+GTB8smfSdv2A6ER0n1mMQ2yBwdarVvBMeiCaioJar4Ex7xjQiQgYLUaYCk1BiJ6BbrMBZiJB8M+HwTxoB4vdAXpLL26k2qBaQOz/B60dESRO8RFzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/bc663/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 213w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/8dc4f/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 425w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/10237/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 850w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/92f8c/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.webp 1200w\"\n              sizes=\"(max-width: 850px) 100vw, 850px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/3cb16/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 213w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/2fbbf/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 425w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/ae694/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 850w,\n/static/a2a55febcf4c4f7b5e29ef0b80538acc/c1b63/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png 1200w\"\n            sizes=\"(max-width: 850px) 100vw, 850px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a2a55febcf4c4f7b5e29ef0b80538acc/ae694/Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg.png\"\n            alt=\"interfaces de Noyau Linux, unified hierarchy cgroups et systemd\"\n            title=\"interfaces de Noyau Linux, unified hierarchy cgroups et systemd\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<a href=\"https://commons.wikimedia.org/wiki/File:Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg\">source</a></p>\n<h1>systemctl</h1>\n<p>Pour <strong>gérer les services</strong> (<code class=\"language-text\">start</code>, <code class=\"language-text\">stop</code>, <code class=\"language-text\">restart</code>, <code class=\"language-text\">status</code>) sur un système Linux disposant de <code class=\"language-text\">systemd</code>, nous pouvons utiliser la commande <code class=\"language-text\">systemctl</code> (anciennement <code class=\"language-text\">service</code>).</p>\n<p>Ces services sont <em>créés/paramétrés</em> via des <em>fichiers de configuration</em> se trouvant dans <code class=\"language-text\">/etc/systemd/system/</code> ce qui permet de <a href=\"https://doc.ubuntu-fr.org/creer_un_service_avec_systemd\">créer simplement soi-même des services</a> pour lancer par ex une application web au démarrage du système.</p>\n<h2>Liste des commandes systemctl</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">systemctl list-units --failed <span class=\"token comment\"># services en échec</span>\nsystemctl list-unit-files <span class=\"token comment\"># ensemble des services installés et leurs status </span>\n\nsystemctl status <span class=\"token comment\"># arborescence</span>\nsystemctl status nom-du-service <span class=\"token comment\"># état du service et ses options/infos de démarrage</span>\n\nsystemctl status/start/stop/restart/reload nom-du-service <span class=\"token comment\"># gestion d'un service</span>\nsystemctl enable/disable nom-du-service <span class=\"token comment\"># activation/désactivation d'un service</span>\n\nsystemctl -p LogLevel show <span class=\"token comment\"># affiche le LogLevel de systemd</span>\nsystemd-analyze set-log-level notice <span class=\"token comment\"># modifier le LogLevel jusqu'au prochain reboot</span>\n\nsystemctl daemon-reexec <span class=\"token comment\"># redémarrage du service systemctl (sans rebooter)</span>\nsystemctl daemon-reload <span class=\"token comment\"># pour prendre en compte une modification de .service</span></code></pre></div>\n<h1>journalctl</h1>\n<p>Les services gérés par <strong>systemd</strong> ont leurs logs accessible par défaut via la commande <code class=\"language-text\">journalctl</code>.</p>\n<p>Pour lister les entrées du journal d’aujourd’hui <strong>spécifique au service spécifié</strong> par l’option <code class=\"language-text\">-u nom-service.service</code> (le <code class=\"language-text\">.service</code> peut etre omis).</p>\n<p>Pour éviter de devoir <code class=\"language-text\">sudo</code> il faut faire parti de l'un des groupes <code class=\"language-text\">adm</code> ou <code class=\"language-text\">systemd-journal</code> (voir <a href=\"linux-gestion-des-utilisateurs.md\">Gestion des groupes d'utilisateurs</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl -u nginx         <span class=\"token comment\"># filtrer par nom de service</span>\njournalctl -f                       <span class=\"token comment\"># follow</span>\njournalctl -n <span class=\"token number\">50</span>                    <span class=\"token comment\"># nombre de lignes</span>\n\njournalctl --since today            <span class=\"token comment\"># --since ou -S</span>\njournalctl --until yesterday        <span class=\"token comment\"># --until ou -U</span>\n\n<span class=\"token comment\">## Exemples</span>\n<span class=\"token comment\"># events de nginx sur la dernière heure</span>\njournalctl -u nginx --output<span class=\"token operator\">=</span>short-full -S -1h\n\n<span class=\"token comment\"># tous les events loggés les 10 dernières minutes </span>\njournalctl -S -10m</code></pre></div>\n<h2>Temps</h2>\n<p>Pour la spécification du temps (<code class=\"language-text\">-S</code> ou <code class=\"language-text\">-U</code>) il est possible de spécifier :</p>\n<ul>\n<li>\"yesterday\", \"today\", \"tomorrow\", \"now\"</li>\n<li>une durée relative avec <code class=\"language-text\">-</code> ou <code class=\"language-text\">+</code> un chiffre et une unité de temps :\n•   usec, us, µs\n•   msec, <code class=\"language-text\">ms</code>\n•   seconds, second, sec, <code class=\"language-text\">s</code>\n•   minutes, minute, min, <code class=\"language-text\">m</code>\n•   hours, hour, hr, <code class=\"language-text\">h</code>\n•   days, day, <code class=\"language-text\">d</code>\n•   weeks, week, <code class=\"language-text\">w</code>\n•   months, month, <code class=\"language-text\">M</code> (defined as 30.44 days)\n•   years, year, <code class=\"language-text\">y</code> (defined as 365.25 days)</li>\n</ul>\n<p>voir <code class=\"language-text\">man systemd.time</code> pour plus d'infos sur les formats de date</p>\n<h2>Gestion du journal</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl --verify\njournalctl --disk-usage</code></pre></div>\n<h2>Vider le journal</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">journalctl --vacuum-time<span class=\"token operator\">=</span>2d\njournalctl --vacuum-size<span class=\"token operator\">=</span>500M</code></pre></div>\n<h1>timedatectl</h1>\n<p>la commande <code class=\"language-text\">timedatectl</code> qui permet de lire et modifier la date/heure/fuseau horaire :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> timedatectl\n<span class=\"token function\">sudo</span> timedatectl list-timezones\n<span class=\"token function\">sudo</span> timedatectl set-timezone Europe/Paris</code></pre></div>\n<h1>Binaires</h1>\n<p>Voici par exemple la liste des binaires systemd présents sur un système <a href=\"https://www.raspberrypi.com/documentation/computers/os.html\">Raspberry Pi OS</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">bluetoothctl\nbootctl\nbusctl\ncec-ctl\ncx18-ctl\nhostnamectl  <span class=\"token operator\">&lt;=</span>\nir-ctl\nivtv-ctl\njournalctl   <span class=\"token operator\">&lt;=</span>\nkeyctl\nlocalectl    <span class=\"token operator\">&lt;=</span>\nloginctl     <span class=\"token operator\">&lt;=</span>\nmedia-ctl\nnetworkctl   <span class=\"token operator\">&lt;=</span>\nobexctl\nrds-ctl\nresolvectl   <span class=\"token operator\">&lt;=</span>\nsystemctl    <span class=\"token operator\">&lt;=</span>\ntimedatectl  <span class=\"token operator\">&lt;=</span>\nudisksctl\nv4l2-ctl\nwdctl</code></pre></div>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://linuxfr.org/news/evolutions-techniques-de-systemd\">Évolutions techniques de systemd</a> sur linuxfr.org 👍 et interview de son créateur <a href=\"https://linuxfr.org/news/un-entretien-avec-lennart-poettering\">Lennart Poettering</a></li>\n<li><a href=\"https://fr.wikipedia.org/wiki/Systemd#Concept\">Conceptes</a> - wikipedia</li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units\">How to use Systemctl</a></li>\n<li>Configurer un <a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples\">redémarrage de service au reboot et après un crash</a></li>\n<li><a href=\"https://wiki.archlinux.org/title/Systemd_(Fran%C3%A7ais)\">systemd</a> de l'ArchWiki</li>\n</ul>\n<h2>Videos</h2>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=NNgZXNQtil8\">We Need to Talk About Systemd</a>: Boot Time Optimization for the New init daemon - Chris Simmonds, 2net</li>\n<li><a href=\"https://www.youtube.com/watch?v=hc7J-zWEty8\">Why Systemd is the Devil but I Love It</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=y3NYrC5RiRo\">Systemd Is Hated By Many, But Does It Deserve It?</a></li>\n</ul>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}