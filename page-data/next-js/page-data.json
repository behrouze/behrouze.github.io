{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/next-js",
    "result": {"pageContext":{"id":"5319cce8-48a9-5612-8074-1c69f619d35c","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/next-js.md","frontmatter":{"categories":["javascript"],"date":"2018-10-02","lastUpdate":"2022-02-02","tags":["javascript","react","nextjs","gaphql","gatsby","jamstack"],"title":"Next.js"},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 459px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.093896713615024%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAuJAAALiQE3ycutAAABqklEQVQoz3WS3cqqQBSGu/Wg0+gSQjpQqShMERSyIrS2dRDVTOLf/KxRM+kaPmrCL/ZmvwfDO2vmGdYa3g5jjFLK3pKGvsW+9L8LHekIIXJPCMnznLzVVhhjaZpmWdYWJfWCOedCCHkAAPe3yrIEAEIIAKRpihCq67qqqpZ8wZzzJEkQQgDAOY+iaLvd+r4fhmEURUIISul8Pl+v10EQ7Ha7LMva/jtVVfm+3+v1six7PB6maWqa9uet0WiUJIlt257nOY4zGAxWq1WSJL9tS1hRFNu2n8+nYRiTyeR4PGKMEUL9ft+yrKZpsiybzWb3+739uQ+82Wxc15WtOo6jqmoQBOfzOc/zbrdrmmbTNAghXdcldrvd5BMfeLFY1HXtuu54PPY8DwDiOFYUBWOs6/p+v0/TVFVVAFgul8Ph8DMzAGCMT6dTWZZxHGuaNp1ODcOwLOtwONR1HUVRGIaMsePxSCm9Xq8IoQ9MCOGcA0Ce50KIy+WCMa6qSghRFEWe55zzoigopUIIxhgASPOa+Tsx0mCM25zIkMgIfK+/Ifkrfd8x/P7bf5P7A8MkXKug+/UxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Nextjs\"\n        title=\"Nextjs\"\n        src=\"/static/6d697d9e0f4fa2c5caf7c96b594b59c2/48711/Nextjs.png\"\n        srcset=\"/static/6d697d9e0f4fa2c5caf7c96b594b59c2/3cb16/Nextjs.png 213w,\n/static/6d697d9e0f4fa2c5caf7c96b594b59c2/2fbbf/Nextjs.png 425w,\n/static/6d697d9e0f4fa2c5caf7c96b594b59c2/48711/Nextjs.png 459w\"\n        sizes=\"(max-width: 459px) 100vw, 459px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Next.js est quasiment devenu un standard en 2022, si bien qu'un concurrent commence a faire surface : <a href=\"https://remix.run/blog/remix-vs-next\">Remix</a>.\n<a href=\"https://nextjs.org/blog/next-12\">Nextjs 12</a> Canary est la version courante et <a href=\"https://vercel.com/\">Vercel</a> (ex <a href=\"https://www.theregister.com/2020/04/22/nextjs_vercel_logowatch/\">Zeit</a>), la société qui est derrière Nextjs a <a href=\"https://techcrunch.com/2021/06/23/vercel-raises-102m-series-c-for-its-next-js-based-front-end-development-platform\">levé 102$ million</a> pour accélérer les développements.</p>\n<p>D'un point de vue de développeur, ce qui rend l'usage de <strong>Next.js intuitif</strong>, réside dans le fait le routage est une correspondance entre un <strong>fichier JavaScript</strong> et une <strong>URL</strong>, le fichier /pages/toto.js générera automatiquement l'URL <a href=\"http://monsite/toto\">http://monsite/toto</a>, et ce modèle supporte le <a href=\"https://nextjs.org/docs/routing/dynamic-routes\">routage dynamique</a> (avec des variables dans l'URL).</p>\n<h2>Avantages</h2>\n<p>Les intérêts de Next.js:</p>\n<ul>\n<li>supporte les méthodes de rendu <a href=\"https://nextjs.org/docs/basic-features/data-fetching/overview\">SSR, SSG et CSR</a></li>\n<li><strong>learning curve</strong> raide pour les développeurs React avec une prise en main rapide grâce à leurs <a href=\"https://nextjs.org/learn/basics/create-nextjs-app\">tuto</a></li>\n<li>utilise un <strong>routage par page</strong> très intuitif</li>\n<li><a href=\"https://nextjs.org/docs/routing/dynamic-routes\">routage dynamique</a></li>\n<li>utilise <a href=\"https://nextjs.org/docs/upgrading#webpack-4-support-has-been-removed\">Webpack 5</a></li>\n<li><a href=\"https://nextjs.org/docs/upgrading\">guides d'upgrade</a> assez clean pour migrer de version de Nextjs</li>\n</ul>\n<h2>Routing</h2>\n<h3>Pages</h3>\n<p>Une <strong>URL</strong> est <strong>crée</strong> <strong>automatiquement</strong> dès qu'on dépose un <strong>fichier JS</strong> ou <strong>JSX</strong> dans le dossier <code class=\"language-text\">/pages/</code>  ou <code class=\"language-text\">/src/pages/</code> (par <strong>convention</strong> ce dossier doit s'appeler <code class=\"language-text\">pages</code>).</p>\n<h3>Public</h3>\n<p>Pour les <strong>éléments statiques</strong> (images, css, <code class=\"language-text\">robots.txt</code>, <code class=\"language-text\">favicon.ico</code>, et autres) il existe le dossier <code class=\"language-text\">/public/</code> (anciennement <code class=\"language-text\">/static/</code>) réservé a cet effet.</p>\n<h2>Navigation</h2>\n<p>La navigation est simplifiée par l'usage de composants Nextjs <a href=\"https://github.com/zeit/next.js#with-link\">Link</a> et <a href=\"https://github.com/zeit/next.js#imperatively\">Router</a> auxquels on peut associer l'<a href=\"https://nodejs.org/api/url.html#url_url_strings_and_url_objects\">objet URL</a>.</p>\n<ul>\n<li>la prop <strong>href</strong> permet au framework de faire le lien entre l'URL et les fichiers JS contenu dans le dossier pages</li>\n<li>la prop <strong>as</strong> permet de créer et d'<strong>afficher dans le HTML résultant</strong> un <em>href alias</em> (ici le lien pointera vers /p/xxx), qu'il faudra traité coté back (méthode render de l'API next).</li>\n</ul>\n<p>Le <a href=\"https://reactjs.org/docs/higher-order-components.html\">HOC</a> <a href=\"https://nextjs.org/docs/#using-a-higher-order-component\">withRouter</a> permet de récupérer dans nos composants, via les props du composant React (props.router):</p>\n<ul>\n<li>les informations de routage (voir l'<a href=\"https://nextjs.org/docs/#imperatively\">API</a>)</li>\n<li>des méthodes de pushState, replaceState et beforePopState</li>\n</ul>\n<h2>Cycle de vie du Router</h2>\n<p>Le Router de Next.js propose un ensemble d'évènements qu'il est possible d'écouter :</p>\n<ul>\n<li><strong>route</strong>ChangeStart(url)</li>\n<li><strong>route</strong>ChangeComplete(url)</li>\n<li><strong>route</strong>ChangeError(err, url)</li>\n<li>before<strong>History</strong>Change(url)</li>\n<li><strong>hash</strong>ChangeStart(url)</li>\n<li><strong>hash</strong>ChangeComplete(url)</li>\n</ul>\n<h2>Server Side Rendering</h2>\n<p>Dans la plupart des cas, des routes simples ne suffiront pas, et on aura des <strong>URL</strong> qui <strong>ne vont plus correspondre à des fichiers</strong> présents dans <strong>/pages</strong>, comme par exemple lorsqu'on utilise les <strong>props \"as\"</strong> du composant **<Link/>.<br>\n**Il est alors <strong>nécessaire</strong> d'utiliser un <strong>routage coté serveur</strong>, voici un exemple en Node/Express (<a href=\"https://github.com/zeit/next.js#custom-server-and-routing\">selon doc</a>):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> handle <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\napp\n<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/produits?/:univers/:category\\*?\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">const</span> actualPage <span class=\"token operator\">=</span> <span class=\"token string\">\"/produits\"</span>\n<span class=\"token keyword\">const</span> queryParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>req<span class=\"token punctuation\">.</span>params <span class=\"token punctuation\">}</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> actualPage<span class=\"token punctuation\">,</span> queryParams<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Appels Ajax</h2>\n<p>Si on suit le <a href=\"https://nextjs.org/learn\">tuto</a> de Next.js, on s’aperçoit qu'ils utilisent la librairie <a href=\"https://github.com/developit/unfetch\">unfetch</a> (très légère) et son compagnon <a href=\"https://github.com/developit/unfetch/tree/master/packages/isomorphic-unfetch\">isomorphic-unfetch</a>, mais on peut bien sure utiliser des librairies plus connues comme <a href=\"https://www.npmjs.com/package/isomorphic-fetch\">isomorphic-fetch</a> ou disposant de plus de fonctionnalités comme <a href=\"https://github.com/axios/axios#axios\">Axios</a> (permet d'annuler les requêtes Ajax).</p>\n<h3>méthode getInitialProps</h3>\n<p>Avec Next.js, on utilise la <strong>méthode statique</strong> <a href=\"https://github.com/zeit/next.js#fetching-data-and-component-lifecycle\">getInitialProps</a> qui permet comme son nom l'indique, de charger les props du composant avec le résultat de la requête Ajax. Il est possible d'utiliser cette méthode de 2 façons:</p>\n<ul>\n<li>soit dans un <strong>composant React</strong> (qui possède donc un lifecyle), en définissant cette méthode:\n<code class=\"language-text\">static async getInitialProps({ req }) {....</code></li>\n<li>soit en définissant un lifecycle methode pris en charge par le framework Nexjs, pour un composant stateless (ici nommé MaPage):\n<code class=\"language-text\">MaPage.getInitialProps = async ({ req }) => {</code></li>\n</ul>\n<h3>propriétés de l'objet context</h3>\n<p>La méthode <strong>getInitialProps</strong> reçoit en <strong>paramètre</strong> un **objet context ** (paramètre <em>req</em> dans les 2 ex ci-dessus) qui contient les informations de routage:</p>\n<ul>\n<li><strong>pathname</strong> - chemin next (correspondant au fichier js)</li>\n<li><strong>asPath</strong> - URL complète telle que visible dans le navigateur <strong>incluant la query string</strong></li>\n<li><strong>query</strong> - <strong>query string</strong> de l'URL parsé dans un objet</li>\n<li><strong>req</strong> - objet <strong>request</strong> HTTP (serveur uniquement)</li>\n<li><strong>res</strong> - objet <strong>response</strong> HTTP (serveur uniquement)</li>\n<li><strong>jsonPageRes</strong> - objet <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Response\">Fetch Response</a> (client uniquement)</li>\n<li><strong>err</strong> - objet Error si une erreur intervient lors du render</li>\n</ul>\n<h2>Styling</h2>\n<h3>CSS avec styled-jsx</h3>\n<p>Nextjs a fait le choix d'utiliser une des solution CSS-in-JS parmi les <a href=\"http://michelebertoli.github.io/css-in-js/\">nombreuses solutions existantes</a>, qui est <strong><a href=\"https://github.com/zeit/styled-jsx#styled-jsx\">styled-jsx</a></strong> qui permet d'avoir des styles scopés au niveau du composant, et surtout d'appliquer les styles lors du rendu coté serveur.</p>\n<p>Les styles ne se propagent pas aux composants enfants par défaut, mais il est possible de <strong>forcer la propagation</strong> en utilisant l'attribut global.<br>\nStyled-jsx est traité dans Nextjs par un plugin Babel styled-jsx/babel.</p>\n<p>L'utilisation est encore une fois très intuitive, car il suffit d'écrire ses styles directement dans des balises <code class=\"language-text\">&lt;style jsx></code>  à l’intérieur de ses composants en utilisant la syntaxe <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\">template strings</a>:</p>\n<style jsx>{`\n    h1, a {\n    font-family: \"Arial\";\n  }\n`}</style>\n<h3>CSS classique</h3>\n<p>Il est recommandé d'utiliser styled-jsx pour le styling, il est cependant possible d'<a href=\"https://github.com/zeit/next.js#importing-css--sass--less--stylus-files\">importer du CSS, SASS, LESS ou Stylus</a> grâce à des plugins Next.</p>\n<p>De plus si on souhaite utiliser une <strong>bibliothèque CSS</strong>, <em>styled-jsx va automatiquement prefixer les noms de classe</em> dans le HTML rendu, ce créera des interferences.<br>\nOn peut éviter cela en utilisant l'attribut <strong>optionCLassName</strong> au lieu du classique <strong>class</strong>.</p>\n<p><code class=\"language-text\">&lt;Select optionClassName=\"react-select\" /></code></p>\n<h2>Squelettes de projets NextJS</h2>\n<p>Un outil sympathique, qui fourni un squelette de projet Nextjs/React/Redux est <a href=\"https://github.com/segmentio/create-next-app/blob/master/README.md\">create-next-app</a>, parfait pour voir rapidement les branchements entre ces outils :)</p>\nConcernant <a href=\"/materialui-react\" title=\"Material UI\">Material UI</a>, il y a un exemple de projet Nexjs/MaterialUI ainsi qu'une doc SSR Material UI."}},
    "staticQueryHashes": ["1026020893","1333896537","28434099"]}