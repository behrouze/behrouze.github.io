{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/linux-gestion-des-utilisateurs","result":{"pageContext":{"id":"e08c2b87-7c08-522f-80f7-cd7d17b4a97b","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/linux-gestion-des-utilisateurs.md","frontmatter":{"categories":["linux"],"date":"2018-08-27","lastUpdate":"2022-03-11","tags":["admin-linux","linux","user","group"],"title":"Linux: gestion des utilisateurs"},"html":"<h1>Gestion d'utilisateurs</h1>\n<h2>Ajout</h2>\n<p><code class=\"language-text\">sudo useradd -m toto</code>  création d'un nouvel utilisateur <em>toto</em>\net l'option <code class=\"language-text\">-m</code>  permet la création automatique d'un dossier personnel <code class=\"language-text\">/home/toto</code>.</p>\n<p><code class=\"language-text\">sudo adduser</code>  est une commande (script perl qui utilise <code class=\"language-text\">useradd</code>) qui fourni une interface plus agréable guidée par une série de questions.</p>\n<h2>Suppression</h2>\n<p><code class=\"language-text\">sudo deluser -r -f toto</code>  : supprime l'utilisateur <em>toto</em> du système.</p>\n<ul>\n<li><code class=\"language-text\">-r</code> supprime le répertoire home de ce user</li>\n<li><code class=\"language-text\">-f</code> force la suppression des fichiers du home, même ceux qui n'appartiennent pas à ce user</li>\n</ul>\n<h2>Désactivation</h2>\n<p><code class=\"language-text\">sudo passwd -l toto</code>  : désactive le login sur le système avec login/mot de passe, attention le login via clé SSH sera toujours fonctionnel avec cette commande. Intervient sur le fichier <code class=\"language-text\">/etc/shadow</code> sans supprimer le dossier utilisateur</p>\n<p><code class=\"language-text\">sudo usermod --expiredate 1 toto</code>  : désactive complètement le compte sans le supprimer du système, bloque également l'accès via clés SSH. Intervient sur le fichier <code class=\"language-text\">/etc/passwd</code></p>\n<p><code class=\"language-text\">usermod</code> permet de changer les caractéristiques d'un compte (expiration, chemin du dossier home, groupes etc)</p>\n<h2>Création ou modification du mot de passe d'un user</h2>\n<p><code class=\"language-text\">sudo passwd toto</code>  permet de modifier interactivement le passwd de <em>toto</em></p>\n<h1>Gestion des groupes d'utilisateurs</h1>\n<h2>Ajout/création d'un groupe</h2>\n<p><code class=\"language-text\">sudo addgroup www-data</code>  <strong>ajoute</strong> un <strong>nouveau groupe</strong> au <strong>système</strong></p>\n<h2>Suppression d'un groupe</h2>\n<p><code class=\"language-text\">sudo delgroup www-data</code>  <strong>supprime</strong> le <strong>groupe</strong> spécifié du <strong>système</strong></p>\n<h2>Ajouter un user à un groupe</h2>\n<p><code class=\"language-text\">sudo usermod -a -G www-data $USER</code>  <strong>ajoute</strong> l'utilisateur courant <strong>au groupe</strong> spécifié</p>\n<h2>Supprimer un user à un groupe</h2>\n<p><code class=\"language-text\">sudo gpasswd -d $USER www-data</code>  supprimer l'utilisateur courant du groupe spécifié (ici www-data)</p>\n<h1>Sudo</h1>\n<p>La commande <a href=\"https://wiki.debian.org/fr/sudo\"><strong>sudo</strong></a> permet à un utilisateur autorisé, d'<strong>exécuter des commandes avec les droits d'admins</strong>. Cette commande (à installer avec apt) s'appuie sur le fichier de conf <strong>/etc/sudoers</strong>.</p>\n<p>Il est <strong>vivement recommandé d'utiliser</strong> l'utilitaire <code class=\"language-text\">visudo</code> pour modifier ce fichier, car il effectuera une vérification syntaxique avant la sauvegarde du fichier <code class=\"language-text\">/etc/sudoers</code>. Il est possible de configurer un éditeur de texte en particulier (ici <code class=\"language-text\">Vim</code>) en lançant <code class=\"language-text\">visudo</code> :</p>\n<p><code class=\"language-text\">sudo VISUAL=$(command -v vi) visudo</code></p>\n<p>La <strong>syntaxe générale</strong> est la suivante :</p>\n<p><code class=\"language-text\">login_du_user ALL =(user) commande1, NOPASSWD: commande2,...</code></p>\n<p>Pour <strong>autoriser un utilisateur</strong> toto à lancer n'importe quelle commandes :</p>\n<p><code class=\"language-text\">toto ALL=(ALL) ALL</code></p>\n<p>et pour autoriser l'exécution de sudo <strong>sans demander de mot de passe</strong> grâce à l'argument <strong>NOPASSWD</strong> (attention danger!):</p>\n<p><code class=\"language-text\">toto ALL=(ALL) NOPASSWD:ALL</code></p>\n<p>Il est également possible d'attribuer les droits à un <strong>groupe d'utilisateurs</strong>, il suffira alors de rajouter notre utilisateur à ce groupe (ex ici un groupe nommé sudo):</p>\n<p><code class=\"language-text\">%sudo ALL=(ALL) NOPASSWD:ALL</code></p>\n<p>Voici la signification de chaque argument (<a href=\"https://serversforhackers.com/c/sudo-and-sudoers-configuration\">tiré de serversforhackers)</a> et l'étendu de leur application :</p>\n<ul>\n<li><strong>toto</strong> ALL=(ALL:ALL) ALL -> utilisateur toto</li>\n<li>toto <strong>ALL</strong>=(ALL:ALL) ALL -> <strong>tous</strong> les utilisateurs totos, loggés depuis <strong>n'importe quel machine</strong></li>\n<li>toto ALL=(<strong>ALL</strong>:ALL) ALL -> utilisateur toto peut exécuter les commandes en tant que <strong>n'importe quel utilisateur</strong></li>\n<li>toto ALL=(ALL:<strong>ALL</strong>) ALL -> utilisateur toto peut exécuter les commandes en tant que <strong>n'importe quel groupe</strong></li>\n<li>toto ALL=(ALL:ALL) <strong>ALL</strong> -> cette règle s'applique à toutes les commandes (c'est ici qu'on spécifie la liste de commandes, si on ne souhaite pas donner accès à toutes les commandes du système)</li>\n<li>toto ALL=(ALL:ALL) **NOPASSWD:**ALL -> aucun password requis pas toto, il peut tout exécuter sur la machine sans limite</li>\n</ul>\n<h1>Fichiers importants</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">/etc/passwd\n/etc/shadow\n/etc/login.defs\n/etc/deluser.conf\n/etc/skel <span class=\"token comment\"># arborescence par défaut copié lors d'un useradd -m</span>\n/etc/sudoers</code></pre></div>"}},"staticQueryHashes":["1026020893","2750442709","28434099"]}