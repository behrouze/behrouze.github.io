{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/installer-wordpress","result":{"pageContext":{"id":"090fb258-c7d5-51dc-8bee-1a7aa3613dea","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/installer-wordpress.md","frontmatter":{"categories":["cms"],"date":"2018-09-11","lastUpdate":"2022-03-09","tags":["admin-linux","wordpress","cli","wp-cli"],"title":"Installation automatis√©e de Wordpress en ligne de commande"},"html":"<h1>Pr√©-requis</h1>\n<p>Pour installer Wordpress rapidement sur un <strong>serveur Linux</strong> en ligne de commandes, il va nous falloir ces 3 √©l√©ments sur le serveur avant de commencer :</p>\n<ol>\n<li>disposer d'un <strong>serveur web Nginx</strong> par exemple, qui est l√©ger rapide et relativement simple a <a href=\"https://www.digitalocean.com/community/tools/nginx?global.app.lang=fr\">configurer</a></li>\n<li><strong>PHP</strong> avec <a href=\"https://www.php.net/manual/fr/install.fpm.php\">PHP-FPM</a> qui est un interpr√©teur PHP Fast Process Manager qui tourne sous forme de daemon (v√©rifier s'il tourne avec <code class=\"language-text\">sudo systemctl status php7.0-fpm</code>). C'est le process qui re√ßoit¬†et traite les requ√™tes Fast/CGI du serveur Nginx en faisant la passerelle avec le code PHP</li>\n<li>disposer d'un SGBD (moteur de base de donn√©es) <strong>MariaDB</strong> en local ou en r√©seau</li>\n</ol>\n<h2>Installation des pr√©-requis sous debian</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> nginx php php-fpm mysql-server php-mysql</code></pre></div>\n<h1>Docs</h1>\n<ul>\n<li>\n<a href=\"/wordpress-wp-cli\" title=\"installation rapide\">installation rapide</a> de wp cli\n</li>\n<li>guide des <a href=\"https://developer.wordpress.org/cli/commands/\">commandes de wp cli</a></li>\n<li><a href=\"https://developer.wordpress.org/cli/commands/core/#subcommands\">liste des sous-commandes</a> de <a href=\"https://developer.wordpress.org/cli/commands/core/\">wp core</a></li>\n</ul>\n<h1>Installation de Wordpress avec wp-cli</h1>\n<p>Pour effectuer une installation en ligne de commande nous allons utiliser l'outil officiel <code class=\"language-text\">wp-cli</code>  et suivre les √©tapes suivantes.</p>\n<p>üîê Pour les commandes ci-dessous, attention √† la s√©curit√© car ces commandes sont loggu√©s dans l'historique du shell, et certaines contiennent des mots de passe.</p>\n<h2>T√©l√©charger Wordpress sur le serveur Nginx</h2>\n<p>Une fois <code class=\"language-text\">wp-cli</code> disponible sur votre syst√®me, il suffit de choisir une version de Wordpress √† installer (derni√®re version stable si non sp√©cifi√©e) avec <a href=\"https://developer.wordpress.org/cli/commands/core/download/\">wp core download</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> /var/www/dossier_d_installation_de_wordpress <span class=\"token comment\"># ou ailleurs ;)</span>\nwp core download\nwp core download <span class=\"token parameter variable\">--version</span><span class=\"token operator\">=</span><span class=\"token number\">5.8</span>.3 <span class=\"token parameter variable\">--locale</span><span class=\"token operator\">=</span>fr_FR <span class=\"token parameter variable\">--path</span><span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> <span class=\"token comment\"># si on souhaite une version sp√©cifique</span></code></pre></div>\n<h2>S√©curiser l'installation de Wordpress</h2>\n<p>Modifier les permissions pour l'utilisateur <code class=\"language-text\">www-data</code> (qui est le user par d√©faut pour le process <code class=\"language-text\">nginx</code>) pour <a href=\"https://wordpress.org/support/article/hardening-wordpress/\">renforcer</a> la s√©curit√© des <a href=\"https://wordpress.org/support/article/hardening-wordpress/#changing-file-permissions\">fichiers</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> www-data:www-data /var/www/wp-hosting/test\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> d <span class=\"token parameter variable\">-exec</span> <span class=\"token function\">chmod</span> <span class=\"token number\">750</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># Change directory permissions rwxr-xr-x</span>\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-exec</span> <span class=\"token function\">chmod</span> <span class=\"token number\">640</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># Change file permissions rw-r--r--</span></code></pre></div>\n<h2>Configuration initiale du wp-config.php et BDD</h2>\n<p>On poursuit en cr√©ant automatiquement le fichier <code class=\"language-text\">wp-config.php</code> avec <a href=\"https://developer.wordpress.org/cli/commands/config/\">wp config</a> puis  cr√©ation des tables de la BDD avec <a href=\"https://developer.wordpress.org/cli/commands/db/\">wp db</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># avec prompt pour le password (option --prompt)</span>\nwp config create <span class=\"token parameter variable\">--dbname</span><span class=\"token operator\">=</span>wordpress <span class=\"token parameter variable\">--dbuser</span><span class=\"token operator\">=</span>root <span class=\"token parameter variable\">--prompt</span><span class=\"token operator\">=</span>dbpass\n<span class=\"token comment\"># ou avec password en clair dans la commande (option --dbpass)</span>\nwp config create <span class=\"token parameter variable\">--dbname</span><span class=\"token operator\">=</span>wordpress <span class=\"token parameter variable\">--dbuser</span><span class=\"token operator\">=</span>root <span class=\"token parameter variable\">--dbpass</span><span class=\"token operator\">=</span>root\n\n<span class=\"token comment\"># cr√©ation de la </span>\nwp db create</code></pre></div>\n<h2>Finalisation de l'installation</h2>\n<p>Puis on termine l'installation avec <a href=\"https://developer.wordpress.org/cli/commands/core/install/\">wp core install</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp core <span class=\"token function\">install</span> <span class=\"token parameter variable\">--url</span><span class=\"token operator\">=</span>http://localhost:8888/dev/wordpress/ <span class=\"token parameter variable\">--title</span><span class=\"token operator\">=</span>WordPress <span class=\"token parameter variable\">--admin_user</span><span class=\"token operator\">=</span>myusername <span class=\"token parameter variable\">--admin_password</span><span class=\"token operator\">=</span>mypassword <span class=\"token parameter variable\">--admin_email</span><span class=\"token operator\">=</span>email@deladmin.com</code></pre></div>\n<h1>Nginx</h1>\nEnfin pour pouvoir servir les pages web, il faut configurer le serveur web, c'est ici que va intervenir php-fpm install√© au <a href=\"/#pre-requis\" title=\"d√©but de l'article\">d√©but de l'article</a> :\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">8000</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">root</span> /var/www/wp-hosting/test</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">index</span> index.php</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">server_name</span> test.mondomaine.com</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">access_log</span> /var/log/nginx/wp-test.access_log</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">error_log</span> /var/log/nginx/wp-test.error_log notice</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token directive\"><span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span>/ /index.php?<span class=\"token variable\">$args</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token directive\"><span class=\"token keyword\">location</span> ~ \\.php$</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token directive\"><span class=\"token keyword\">include</span> snippets/fastcgi-php.conf</span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">fastcgi_pass</span> unix:/var/run/php/php7.0-fpm.sock</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>Cr√©ation manuelle de la base de donn√©es</h1>\n<p>La Base de donn√©es Wordpress peut √©galement etre cr√©√©e manuellement.\nPour cela, se connecter √† MariaDB</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> mysql <span class=\"token parameter variable\">-u</span> root\n<span class=\"token function\">sudo</span> mysql <span class=\"token parameter variable\">-u</span> root <span class=\"token parameter variable\">-ppassword</span> <span class=\"token comment\"># si on avait d√©ja sett√© le password root</span></code></pre></div>\n<p>puis ex√©cuter les commandes suivantes :</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">show</span> <span class=\"token keyword\">databases</span><span class=\"token punctuation\">;</span>                        <span class=\"token comment\">-- lister les base d√©j√† pr√©sente</span>\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">database</span> wordpress_test<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span> wordpress_test<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">\"login_utilisateur_de_test\"</span><span class=\"token variable\">@\"localhost\"</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'mot_de_passe'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">--cr√©ation du login/passsword pour notre nouvelle BDD</span></code></pre></div>"}},"staticQueryHashes":["1026020893","2750442709","28434099"]}