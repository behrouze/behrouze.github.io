{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/shell-tips-tricks","result":{"pageContext":{"id":"6826a6c7-094f-5dac-bff6-16da718ff364","fileAbsolutePath":"/Users/behrouze/Sources/gatsby-blog/obsidian/Blog/shell-tips-tricks.md","frontmatter":{"categories":["linux"],"date":"2018-05-16","lastUpdate":null,"tags":["admin-linux","bash","linux","memo","shell","tips","dual-boot"],"title":"Linux Shell tips & tricks"},"html":"<h3>Recharger des fichiers de conf sans se déconnecter</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">.</span> ~/.profile</code></pre></div>\n<p>est strictement équivalent à:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">source</span> ~/.profile</code></pre></div>\n<p>la commande <strong>source</strong> exécute le script spécifié dans le shell actuel.</p>\n<h3>Obtenir son adresse IP publique</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">dig</span> +short myip.opendns.com @resolver1.opendns.com\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> http://whatismyip.akamai.com\n<span class=\"token function\">curl</span> wgetip.com</code></pre></div>\n<h3>Changer de Shell</h3>\n<p>Vérifier si on est en shell <a href=\"https://fr.wikipedia.org/wiki/Bourne-Again_shell#Histoire\"><strong>Bash</strong></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$SHELL</span> retourne /bin/bash</code></pre></div>\n<p>puis pour passer sous <a href=\"https://fishshell.com/docs/current/tutorial.html#tut_why_fish\"><strong>Fish</strong></a> par exemple ajouter le path du binaire du nouveau Shell dans /etc/shells puis:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">chsh <span class=\"token parameter variable\">-s</span> /usr/bin/fish</code></pre></div>\n<h3>Lister les port écoutés</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tupln</span></code></pre></div>\n<h3>Raccourcis Bash</h3>\n<p><code class=\"language-text\">CTRL + A</code> : <strong>début</strong> de <strong>ligne</strong>\n<code class=\"language-text\">CTRL + E</code> : <strong>fin</strong> de <strong>ligne</strong></p>\n<p><code class=\"language-text\">ALT + B</code> : <strong>reculer</strong> 1 <strong>mot</strong>\n<code class=\"language-text\">ALT + F</code> : <strong>avancer</strong> 1 <strong>mot</strong></p>\n<p><code class=\"language-text\">!une_commande</code> : exécute la commande avec les arguments de sa <strong>dernière exécution</strong> (ex: <code class=\"language-text\">!ls</code>)</p>\n<p><code class=\"language-text\">CTRL + R</code> : permet de <strong>naviguer</strong> à travers l'<strong>historique</strong> des commandes (interractif)</p>\n<p><a href=\"https://www.howtogeek.com/howto/ubuntu/keyboard-shortcuts-for-bash-command-shell-for-ubuntu-debian-suse-redhat-linux-etc/\">source</a></p>\n<h3>Correction du décallage d'heure en dual boot</h3>\n<p>Pour corriger de l'horloge en dual-boot avec Windows ie le passage de Linux a Windows génère un décallage de l'heure système, le paramètre \"<em>RTC in local TZ</em>\" doit passer de no à yes</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> timedatectl set-local-rtc <span class=\"token number\">1</span> --adjust-system-clock</code></pre></div>\n<p><a href=\"https://www.howtogeek.com/323390/how-to-fix-windows-and-linux-showing-different-times-when-dual-booting/\">source</a></p>\n<p><code class=\"language-text\">timedatectl</code> est issue de l'écosystème <a href=\"linux-systemd.md\">linux-systemd</a></p>\n<h3>Localiser un binaire</h3>\n<p>la commande <code class=\"language-text\">command -v</code> est à <a href=\"https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script\">favoriser par rapport à <strong>which</strong></a> qui est un process externe (sécurité, performances etc.) et cherche les binaires (<strong>pas uniquement dans le PATH</strong>)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">command</span> <span class=\"token parameter variable\">-v</span> monbinaire</code></pre></div>\n<p><code class=\"language-text\">locate</code> recherche des entrées dans une <strong>base de données mlocate</strong> mise à jour régulièrement par la système. Cherche une correspondance sur tout le chemin, il est possible d'utiliser le -r (regex)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">locate</span> <span class=\"token parameter variable\">-r</span> '^.<span class=\"token punctuation\">\\</span>*/monbinaire</code></pre></div>\n<p><code class=\"language-text\">find</code> peut avec les arguments <code class=\"language-text\">-exec</code> ou <code class=\"language-text\">-ok</code> être utilisé pour exécuter des instructions sur les résultats de la commande</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">find</span> <span class=\"token parameter variable\">-name</span> <span class=\"token string\">'\\*onbinaire'</span> <span class=\"token parameter variable\">-print</span> <span class=\"token parameter variable\">-ok</span> <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-l</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">grep -R</code> en excluant des dossiers</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-iR</span> --exclude-dir<span class=\"token operator\">=</span>node_modules <span class=\"token string\">' port '</span> <span class=\"token punctuation\">\\</span>*</code></pre></div>\n<h3>Fichiers et droits</h3>\n<p><strong>chown</strong> possède de nombreuses options, pour affecter des dossiers/fichiers de façon sélective:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">chown</span> www-data:www-data /tmp/toto <span class=\"token comment\"># modifie user:groupe</span>\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> www-data:www-data /tmp/toto <span class=\"token comment\"># modifie récursivement</span>\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-h</span> www-data:www-data /tmp/toto <span class=\"token comment\"># modifier les droits sur les symlinks eux même (et non la cible du lien)</span>\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>behrouze www-data /tmp/toto <span class=\"token comment\"># modifie le owner des fichier de l'utilisateur spécifié</span>\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>:old-group :new-group /tmp/toto <span class=\"token comment\"># modifie le groupe des fichier du groupe old-group</span>\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">--reference</span><span class=\"token operator\">=</span>fichier-source fichier-cible <span class=\"token comment\"># copie les droits d'un fichier existant</span>\n<span class=\"token function\">chown</span> g+s www-data /toto/ <span class=\"token comment\"># utilisation du SGID, appliqué à tout nouveau fichier créé</span></code></pre></div>\n<h3>Debugger en Bash</h3>\n<p>mode debug: <code class=\"language-text\">set -x</code>  et pour remettre en mode normal: <code class=\"language-text\">set +x</code></p>\n<h3>Executer une succession de commandes en root</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'cat fichier|grep -v \"#\" > /etc/nginx/sites-available/monsite.conf'</span></code></pre></div>\n<h3>Grep</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-A</span> <span class=\"token number\">5</span> <span class=\"token comment\"># affiche les 5 lignes suivants le pattern trouvé</span>\n<span class=\"token function\">grep</span> <span class=\"token parameter variable\">-B</span> <span class=\"token number\">5</span> <span class=\"token comment\"># précédent</span>\n<span class=\"token function\">grep</span> <span class=\"token parameter variable\">-C</span> <span class=\"token number\">5</span> <span class=\"token comment\"># avant et après</span>\n<span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token parameter variable\">-w</span> <span class=\"token string\">'version|number'</span> fichier <span class=\"token comment\"># cherche les mots version OU number dans le fichier</span></code></pre></div>\n<h3>MAJ du système</h3>\n<p>Pour appliquer les MAJ de sécurité automatiquement utiliser l'utilitaire <a href=\"https://guide.ubuntu-fr.org/server/automatic-updates.html\">unattended-upgrades</a>. A noter que mettre un apt update dans un crontab sera souvent en échec car le <a href=\"https://unix.stackexchange.com/questions/160019/dpkg-cannot-find-ldconfig-start-stop-daemon-in-the-path-variable\">PATH n'est pas setté</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># pour vérifier la date du dernier apt update voir la date de dernière modif du fichier pkgcache.bin :</span>\n<span class=\"token function\">ls</span> <span class=\"token parameter variable\">-l</span> /var/cache/apt/pkgcache.bin\n\n<span class=\"token comment\"># ou avec les détails des dates d'accès :</span>\n<span class=\"token function\">stat</span> /var/cache/apt/pkgcache.bin\n\n<span class=\"token comment\"># le dernier apt upgrade :</span>\n<span class=\"token function\">tail</span> <span class=\"token parameter variable\">-1</span> /var/log/apt/history.log</code></pre></div>\n<h3>Changer l'éditeur de texte par défaut</h3>\n<p>Un éditeur de text par défaut doit être sélectionné pour utiliser par exemple les commandes tels que crontab -e , et nous avons le choix parmis les éditeurs installés (souvent au moins vim et nano):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">select-editor</code></pre></div>\n<h3>Changer le nom de sa machine</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /etc/hostname\n<span class=\"token function\">vi</span> /etc/hosts</code></pre></div>\n<h3>Distribution Linux</h3>\n<p>Pour déterminer la distribution les infos se trouvent:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-a</span>\n<span class=\"token function\">cat</span> /etc/os-release\n<span class=\"token function\">cat</span> /proc/version\nhostnamectl</code></pre></div>\n<h3>Reboots</h3>\n<p>affiche la date et heure des 3 derniers redémarrage (complète uptime  qui donne la durée)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">last -x<span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token function\">shutdown</span> <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-3</span>  </code></pre></div>\n<h3>Grub</h3>\n<p>Pour customiser Grub (OS loader) en ajoutant la mémorisation du dernier choix, ainsi que l'ajout d'une image de background perso, il faut éditer le fichier sudo <code class=\"language-text\">vi /etc/default/grub</code>  et ajouter/modifier :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">GRUB_DEFAULT</span><span class=\"token operator\">=</span>saved\n<span class=\"token assign-left variable\">GRUB_SAVEDEFAULT</span><span class=\"token operator\">=</span>true\n<span class=\"token assign-left variable\">GRUB_BACKGROUND</span><span class=\"token operator\">=</span><span class=\"token string\">\"/home/behrouze/Images/Grub.jpg\"</span></code></pre></div>\n<p>et faire prendre en compte les modifications par un <code class=\"language-text\">sudo update-grub</code>.</p>"}},"staticQueryHashes":["1026020893","2750442709","28434099"]}