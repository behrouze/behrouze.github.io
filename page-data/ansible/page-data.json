{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/ansible",
    "result": {"pageContext":{"id":"23d4fbc4-a04f-57ed-bbe5-7cbd1cb39c5f","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/ansible.md","frontmatter":{"categories":["devops"],"date":"2020-04-04","lastUpdate":"2022-02-14","tags":["devops","linux","productivite"],"title":"Ansible"},"html":"<p>Outil permettant de <strong>déployer</strong>, <strong>modifier</strong>, maintenir la <strong>configuration</strong> (fichiers, services, etc.) d’un nombre important d’hôtes de <strong>façon centralisée</strong> (via ssh)</p>\n<h1>Concepts et vocabulaire</h1>\n<p>Les <a href=\"https://docs.ansible.com/ansible/latest/user_guide/basic_concepts.html\">concepts</a> utilisés sont assez simple, on parle de :</p>\n<ul>\n<li><strong>nœuds</strong> : éléments du réseau: serveurs, matériel réseau, IOC etc.</li>\n<li>nœud <strong>contrôleur</strong> ou nœud <strong>maitre</strong> : machine qui va exécuter les commandes <code class=\"language-text\">ansible</code> et <code class=\"language-text\">ansible-playbook</code> etc qui vont déclencher l’exécution des modules Ansible sur les nœuds enfants</li>\n<li>nœuds <strong>gérés</strong> ou nœuds <strong>enfants</strong></li>\n<li><strong>inventaire</strong> : liste structurée des nœuds à gérer</li>\n<li><strong>tache</strong> : unité d’exécution d’Ansible</li>\n<li><strong>playbooks</strong> : ensemble de taches Ansible a exécuter (fichier <code class=\"language-text\">.yml</code>)</li>\n<li><strong>modules</strong> : c’est là qu’on trouve la puissance de cet outil tant le <a href=\"https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html\">nombre de modules fournis est important</a> et permet de gérer des type de nœuds ou taches variés</li>\n</ul>\n<h2>Modules Ansible</h2>\n<p>Ansible dispose d’un système de <strong>collections</strong> de <strong>modules</strong> qui lui permettent d’agir sur les nœuds.\nLes <a href=\"https://docs.ansible.com/ansible/latest/plugins/module.html\">modules</a> sont le cœur d’Ansible et permettent les exécutions sur les nœuds distants, voir <a href=\"https://docs.ansible.com/ansible/latest/user_guide/modules_intro.html\">doc d'intro</a> et la <a href=\"https://docs.ansible.com/ansible/latest/collections/index.html#list-of-collections\">liste de tous les collections</a> et <a href=\"https://docs.ansible.com/ansible/latest/collections/community/general/index.html#modules\">modules</a>.</p>\n<p>On trouvera par exemple le module <a href=\"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#command-module\">command</a> qui permet d’exécuter une commande sur les machine distantes.</p>\n<h2>Facts</h2>\n<p>Les <a href=\"https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html#term-Facts\">facts</a> sont des informations basiques concernant un nœud, recueillis par Ansible.<br>\nVoir <code class=\"language-text\">gather_subset</code> et <code class=\"language-text\">gather_facts</code></p>\n<h1>Installation</h1>\n<p><strong>Ansible</strong> doit être <a href=\"https://docs.ansible.com/ansible/latest/reference_appendices/python_3_support.html#using-python-3-on-the-managed-machines-with-commands-and-playbooks\">pour utiliser Python 3</a>, sur les machines hotes, pour Python3 devrait etre détecté automatiquement, cependant, il est possible de spécifier explicitement l'emplacement du binaire a utiliser à traver un fichier d’inventaire (ou spécifier l’argument <code class=\"language-text\">-e</code> des CLI) :</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">all:vars</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">ansible_python_interpreter</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/python3</span></code></pre></div>\n<h1>Commande ad-hoc</h1>\n<p>Il est possible d’exécuter une commande de façon unitaire, pour cela on utilisera la commande <code class=\"language-text\">ansible</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ansible meswebservers -i inventaire.conf -m copy -a <span class=\"token string\">\"src=~/fichier dest=~/chemin/fichierdest\"</span> --check --diff\n\nansible meswebservers -i inventaire.conf -m <span class=\"token function\">service</span> -a <span class=\"token string\">\"name=wpa_supplicant state=stopped enabled=no\"</span> --become\n\nansible meswebservers -i inventaire.conf -m <span class=\"token function\">apt</span> -a <span class=\"token string\">\"update_cache=yes autoclean=yes\"</span> --become</code></pre></div>\n<ul>\n<li><code class=\"language-text\">-m</code> : nom du module utilisé (ici <a href=\"https://docs.ansible.com/ansible/latest/modules/copy_module.html#parameters\">copy</a>)</li>\n<li><code class=\"language-text\">-i</code> : nom du fichier d’inventaire (possible d’utiliser localhost à la place)</li>\n<li><code class=\"language-text\">-a</code> : arguments du module</li>\n<li><code class=\"language-text\">--check</code> : <em>dry run</em></li>\n<li><code class=\"language-text\">--diff</code> : montre les différences à l’exécution</li>\n<li><code class=\"language-text\">--become</code> : effectue un <code class=\"language-text\">sudo</code></li>\n</ul>\n<h1>Playbooks</h1>\n<p>Le mode d’utilisation par <a href=\"https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html\">yaml</a>) permet réellement d’orchestrer, ordonnancer de façon synchrone ou asynchrone des ensemble de <em>plays</em>.</p>\n<p>Voici un exemple de playbook (exemple.yml):</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> meswebservers\n<span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">copy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">src</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"~/fichier\"</span>\n      <span class=\"token key atrule\">dest</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"chemin/fichierdest\"</span></code></pre></div>\n<p>et on exécute le contenu de ce fichier avec la commande:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ansible-playbook -i inventaire.cfg --check exemple.yml</code></pre></div>\n<h1>Liens</h1>\n<ul>\n<li><a href=\"https://blog.gruntwork.io/why-we-use-terraform-and-not-chef-puppet-ansible-saltstack-or-cloudformation-7989dad2865c\">Configuration Management vs Provisioning</a></li>\n<li><a href=\"https://www.edureka.co/blog/chef-vs-puppet-vs-ansible-vs-saltstack/\">popularité</a> des configuration management tools (Chef, Puppet, Ansible, et SaltStack)</li>\n<li><a href=\"https://www.ansible.com/resources/videos/quick-start-video?extIdCarryOver=true&#x26;sc_cid=701f2000001OH7YAAW\">Vidéo d’introduction</a> sur Ansible</li>\n</ul>"}},
    "staticQueryHashes": ["1026020893","28434099","3153813225"]}