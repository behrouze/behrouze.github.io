{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/wordpress-wp-cli",
    "result": {"pageContext":{"id":"04a30cb5-6c27-504b-a423-c804f7914c31","fileAbsolutePath":"/Users/behrouze/Sources/gatsby-blog/obsidian/Blog/wordpress-wp-cli.md","frontmatter":{"categories":["cms"],"date":"2018-05-19","lastUpdate":"2022-02-19","tags":["linux","productivite","shell","wordpress","CLI"],"title":"Wordpress en ligne de commande: wp-cli"},"html":"<p><a href=\"https://make.wordpress.org/cli/handbook/#guides\"><code class=\"language-text\">wp-cli</code></a> est l'outil officiel de gestion de Wordpress en ligne de commande (<code class=\"language-text\">CLI</code>).\nIl permet notamment :</p>\n<ul>\n<li>d'installer Wordpress, des plugins ou des thèmes</li>\n<li>mettre à jour la version d'une installation Wordpress existante et d'accéder plus généralement aux <a href=\"https://make.wordpress.org/cli/handbook/commands-cookbook/#overview\">fonctionnalités coté admin</a> en ligne de commande</li>\n<li>sauvegarder son installation Wordpress</li>\n</ul>\n<h2>Installer wp-cli</h2>\n<p>Le process d'installation (<a href=\"https://make.wordpress.org/cli/handbook/installing/#recommended-installation\">voir doc officielle</a>) consiste à récupérer l'outil (<em>qui est un script php</em>, fichier <code class=\"language-text\">.phar</code>), et de le rendre disponible dans le PATH</p>\n<ol>\n<li><strong>Installer</strong> <code class=\"language-text\">wp-cli</code> avec <code class=\"language-text\">curl</code> :</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</code></pre></div>\n<ol start=\"2\">\n<li><strong>vérifier</strong> l'installation</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">php wp-cli.phar --info</code></pre></div>\n<ol start=\"3\">\n<li><strong>rendre exécutable</strong> le fichier <strong>.phar</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x wp-cli.phar</code></pre></div>\n<ol start=\"4\">\n<li><strong>déplacer</strong> le script dans <code class=\"language-text\">/usr/local/bin</code>, pour la rendre exécutable depuis le PATH et la <strong>renommer pour simplifier</strong> <code class=\"language-text\">wp-cli.phar</code> en <code class=\"language-text\">wp-cli</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> wp-cli.phar /usr/local/bin/wp-cli</code></pre></div>\n<ol start=\"5\">\n<li>créer un <strong>raccourci</strong> (symlink) pour avoir votre PATH la commande <code class=\"language-text\">wp-cli</code> mais aussi <code class=\"language-text\">wp</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/bin/wp-cli /usr/local/bin/wp</code></pre></div>\n<ol start=\"6\">\n<li><strong>vérifier l'accessibilité</strong> de la nouvelle commande <code class=\"language-text\">wp</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp --info</code></pre></div>\n<h2>Mette à jour wp-cli</h2>\n<p>Le script <code class=\"language-text\">wp-cli</code> peut simplement se mettre à jour via : <code class=\"language-text\">wp cli update</code></p>\n<h2>Utilisation de wp-cli</h2>\n<p>A partir de là vous pouvez effectuer une <a href=\"https://make.wordpress.org/cli/handbook/quick-start/#practical-examples\">fresh install de wordpress</a> ou effectuer une mise à jour de votre installation Wordpress :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> wp core update --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --allow-root</code></pre></div>\n<p>Pour télécharger la dernière version dans un dossier donné (ici <code class=\"language-text\">/tmp/test</code>) :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> -u www-data wp core download --force --path<span class=\"token operator\">=</span><span class=\"token string\">'/tmp/test'</span></code></pre></div>\n<p>vérifier la <strong>version de Wordpress</strong> fraichement téléchargée:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">find</span> /var/www/wordpress/ -name <span class=\"token string\">'version.php'</span> -exec <span class=\"token function\">grep</span> <span class=\"token string\">'$wp_version ='</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Mode maintenance</h3>\n<p><code class=\"language-text\">wp-cli</code> nous permet d'activer un mode \"maintenance\" avec <code class=\"language-text\">wp maintenance-mode</code></p>\n<blockquote>\n<p>Activates, deactivates or checks the status of the maintenance mode of a site.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp maintenance-mode &lt;command>\n  activate        Activates maintenance mode.\n  deactivate      Deactivates maintenance mode.\n  is-active       Detects maintenance mode status.\n  status          Displays maintenance mode status.</code></pre></div>\n<h3>Migration de nom de domaine</h3>\n<ul>\n<li>tester si une instance de WP tourne actuellement pour l'installation souhaitée:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp core is-installed --allow-root --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span></code></pre></div>\n<ul>\n<li>effectuer un backup complet de la base WP dans un .sql avec <code class=\"language-text\">wp db export</code> :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp db <span class=\"token builtin class-name\">export</span> --allow-root --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> nom_de_mon_dump.sql</code></pre></div>\n<ul>\n<li>la commande <code class=\"language-text\">search</code> n'existant pas, il faut ruser et utiliser <code class=\"language-text\">wp search-replace</code> avec l'option <code class=\"language-text\">--dry-run</code> pour rechercher un élément :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp search-replace http://ancien.com http://nouveau.com --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --dry-run</code></pre></div>\n<ul>\n<li>modifier en base toutes les occurences de l'ancien nom de domaine avec <code class=\"language-text\">wp search-replace</code> :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp search-replace <span class=\"token string\">'http://ancien.com'</span> <span class=\"token string\">'http://nouveau.com'</span> --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --allow-root</code></pre></div>\n<h3>Reset du mot de passe d'un utilisateur</h3>\n<p>Il est possible de modifier le mot de passe d'un utilisateur quelconque, notamment de l'admin sur une instance Wordpress spécifique:</p>\n<p><code class=\"language-text\">wp user list</code>  pour récupérer la liste des utilisateurs enregistrés, ainsi que leurs roles puis <code class=\"language-text\">wp user update</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp user update login_de_l_utilisateur --user_pass<span class=\"token operator\">=</span><span class=\"token string\">\"nouveau_mot_de_passe\"</span>  --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress/'</span></code></pre></div>"}},
    "staticQueryHashes": ["1026020893","1333896537","28434099"]}