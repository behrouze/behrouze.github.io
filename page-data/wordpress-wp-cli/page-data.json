{
    "componentChunkName": "component---src-templates-wp-post-tsx",
    "path": "/wordpress-wp-cli",
    "result": {"pageContext":{"id":"d9d0a51f-47f7-5193-b094-4e48cf895858","fileAbsolutePath":"/home/behrouze/Sources/gatsby-blog/obsidian/Blog/wordpress-wp-cli.md","frontmatter":{"categories":["cms"],"date":"2018-05-19","lastUpdate":null,"tags":["linux","productivite","shell","wordpress","CLI"],"title":"Wordpress en ligne de commande: wp-cli"},"html":"<p><a href=\"https://make.wordpress.org/cli/handbook/#guides\">WP-CLI</a> est l'outil officiel de gestion de Wordpress en ligne de commande (CLI).\nIl permet notamment :</p>\n<ul>\n<li>installer Wordpress, des plugins ou des thèmes</li>\n<li>mettre à jour la version d'une installation Wordpress existante et d'accéder plus généralement aux <a href=\"https://make.wordpress.org/cli/handbook/commands-cookbook/#overview\">fonctionnalités coté admin</a> en ligne de commande</li>\n<li>sauvegarder son installation Wordpress</li>\n</ul>\n<h2>Installer wp-cli</h2>\n<p>Le process d'installation consiste à récupérer l'outil (<em>qui est un script php</em>), et de le rendre disponible dans le PATH</p>\n<ol>\n<li><strong><a href=\"https://make.wordpress.org/cli/handbook/installing/#recommended-installation\">Installer</a></strong> wp-cli</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</code></pre></div>\n<ol start=\"2\">\n<li><strong>vérifier</strong> l'installation</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">php wp-cli.phar --info</code></pre></div>\n<ol start=\"3\">\n<li><strong>rendre exécutable</strong> le fichier <strong>.phar</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x wp-cli.phar</code></pre></div>\n<ol start=\"4\">\n<li><strong>déplacer</strong> le script dans /usr/local/bin, pour la rendre exécutable depuis le PATH et la <strong>renommer pour simplifier</strong> wp-cli.phar en wp-cli</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> wp-cli.phar /usr/local/bin/wp-cli</code></pre></div>\n<ol start=\"5\">\n<li>créer un <strong>raccourci</strong> (symlink) pour avoir votre PATH la commande <strong>wp-cli</strong> mais aussi <strong>wp</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/bin/wp-cli /usr/local/bin/wp</code></pre></div>\n<ol start=\"6\">\n<li><strong>vérifier l'accessibilité</strong> de la nouvelle commande <strong>wp</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp --info</code></pre></div>\n<h2>Mette à jour wp-cli</h2>\n<p>Le script wm-cli peut lui meme etre mis à jour et cela ne se fait pas automatiquement, mais il peut simplement se mettre à jour via : wp cli update</p>\n<h2>Utilisation de wp-cli</h2>\n<p>A partir de là vous pouvez effectuer une <a href=\"https://make.wordpress.org/cli/handbook/quick-start/#practical-examples\">fresh install de wordpress</a> ou effectuer une mise à jour de votre installation Wordpress, il suffit de</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> wp core update --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --allow-root</code></pre></div>\n<p>Bien sure avec la Debian (Ubuntu etc.) le wp-config.php étant déplacé dans /etc cette commande ne fonctionne pas... il faut alors télécharger la dernière version dans le dossier de wordpress (à vos risques et périles, backup de tout le dossier avant cette manip) avec la commande:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> -u www-data wp core download --force</code></pre></div>\n<p>vérifier la <strong>version de Wordpress</strong> fraichement téléchargée:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">find</span> /var/www/wordpress/ -name <span class=\"token string\">'version.php'</span> -exec <span class=\"token function\">grep</span> <span class=\"token string\">'$wp_version ='</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Migration de nom de domaine</h2>\n<ul>\n<li>tester si une instance de WP tourne actuellement pour l'installation souhaitée:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp core is-installed --allow-root  --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span></code></pre></div>\n<ul>\n<li>effectuer un backup complet de la base WP dans un .sql</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp db <span class=\"token builtin class-name\">export</span> --allow-root nom_de_mon_dump.sql</code></pre></div>\n<ul>\n<li>modifier en base toutes les occurences de l'ancien nom de domaine:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp search-replace <span class=\"token string\">'http://ancien.com'</span> <span class=\"token string\">'http://nouveau.com'</span>  --allow-root</code></pre></div>\n<h2>Reset du mot de passe d'un utilisateur</h2>\n<p>Il est possible de modifier le mot de passe d'un utilisateur quelconque, notamment de l'admin sur une instance Wordpress spécifique:</p>\n<p><code class=\"language-text\">wp user list</code>  pour récupérer la liste des utilisateurs enregistrés, ainsi que leurs roles puis <code class=\"language-text\">wp user update</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp user update login_de_l_utilisateur --user_pass<span class=\"token operator\">=</span><span class=\"token string\">\"nouveau_mot_de_passe\"</span>  --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress/'</span></code></pre></div>"}},
    "staticQueryHashes": ["1026020893","1333896537","28434099"]}