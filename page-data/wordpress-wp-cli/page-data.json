{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/wordpress-wp-cli","result":{"pageContext":{"id":"f3ac5cde-8949-5d06-8218-371d11fac5fd","fileAbsolutePath":"/home/behrouze/Sources/blog/obsidian/Blog/wordpress-wp-cli.md","frontmatter":{"categories":["cms"],"date":"2018-05-19","lastUpdate":"2022-03-09","tags":["linux","productivite","shell","wordpress","cli","wp-cli"],"title":"Wordpress en ligne de commande: wp-cli"},"html":"<p><a href=\"https://make.wordpress.org/cli/handbook/#guides\"><code class=\"language-text\">wp-cli</code></a> est l'outil officiel de gestion de Wordpress en ligne de commande (<code class=\"language-text\">CLI</code>).\nIl permet notamment :</p>\n<ul>\n<li>d'installer Wordpress</li>\n<li>d'installer des plugins ou des th√®mes Wordpress</li>\n<li>mettre √† jour la version d'une installation Wordpress existante et d'acc√©der plus g√©n√©ralement aux <a href=\"https://make.wordpress.org/cli/handbook/commands-cookbook/#overview\">fonctionnalit√©s cot√© admin</a> en ligne de commande</li>\n<li>sauvegarder son installation Wordpress</li>\n</ul>\n<p><a href=\"https://developer.wordpress.org/cli/commands/\">voir liste des commandes</a></p>\n<h1>Installer et mettre √† jour wp-cli</h1>\n<h2>Installation</h2>\n<p>Le process d'installation consiste √† r√©cup√©rer l'outil (<em>qui est un script php</em>, fichier <code class=\"language-text\">.phar</code>), et de le rendre disponible dans le PATH</p>\n<ol>\n<li><strong>Installer</strong> <code class=\"language-text\">wp-cli</code> avec <code class=\"language-text\">curl</code> :</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</code></pre></div>\n<ol start=\"2\">\n<li><strong>v√©rifier</strong> l'installation</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">php wp-cli.phar --info</code></pre></div>\n<ol start=\"3\">\n<li><strong>rendre ex√©cutable</strong> le fichier <strong>.phar</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x wp-cli.phar</code></pre></div>\n<ol start=\"4\">\n<li><strong>d√©placer</strong> le script dans <code class=\"language-text\">/usr/local/bin</code>, pour la rendre ex√©cutable depuis le PATH et la <strong>renommer pour simplifier</strong> <code class=\"language-text\">wp-cli.phar</code> en <code class=\"language-text\">wp-cli</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> wp-cli.phar /usr/local/bin/wp-cli</code></pre></div>\n<ol start=\"5\">\n<li>cr√©er un <strong>raccourci</strong> (symlink) pour avoir votre PATH la commande <code class=\"language-text\">wp-cli</code> mais aussi <code class=\"language-text\">wp</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/bin/wp-cli /usr/local/bin/wp</code></pre></div>\n<ol start=\"6\">\n<li><strong>v√©rifier l'accessibilit√©</strong> de la nouvelle commande <code class=\"language-text\">wp</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp --info</code></pre></div>\n<p><a href=\"https://make.wordpress.org/cli/handbook/installing/#recommended-installation\">voir doc officielle</a></p>\n<h2>Mise √† jour</h2>\n<p>Le script <code class=\"language-text\">wp-cli</code> se met √† jour simplement via la commande</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp cli update</code></pre></div>\n<h1>Utilisation de wp-cli</h1>\n<p>A partir de l√† vous pouvez effectuer une <a href=\"installer-wordpress.md\">fresh install de wordpress</a>, effectuer une mise √† jour de votre installation Wordpress, installer un theme ou un plugin en 1 commande üéâ !</p>\n<p>Pour l'ensemble des commandes wp il existe un <a href=\"https://make.wordpress.org/cli/handbook/references/config/\">ensemble d'options communes</a> appel√©s param√®tres globaux (ex <code class=\"language-text\">--path</code>).</p>\n<h2>sudo wp-cli</h2>\n<p>L'utilisation de <code class=\"language-text\">sudo</code> avec la commande <code class=\"language-text\">wp</code> nous affiche des messages auxquelles il faut preter attention, cependant si elles n√©cessitent <code class=\"language-text\">sudo</code>, il existe l'option <code class=\"language-text\">--allow-root</code>  de <code class=\"language-text\">wp</code> (cas d'usage : docker containers).</p>\n<p>Plus r√©cement depuis la <a href=\"https://make.wordpress.org/cli/2022/01/26/wp-cli-v2-6-0-release-notes/\">version 2.6.0</a> du wp cli, une <a href=\"https://make.wordpress.org/cli/#new-environment-variable-wp-cli-allow-root\">variable d'environnement</a> <code class=\"language-text\">WP_CLI_ALLOW_ROOT</code> permet de s'affranchir de cette option.</p>\n<h2>Upgrade de Wordpress en 30sec</h2>\n<p>Pour mettre a jour sa version de Wordpress, ses <a href=\"https://developer.wordpress.org/cli/commands/theme/update/\">th√®mes</a>, <a href=\"https://developer.wordpress.org/cli/commands/plugin/update/\">plugins</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Mettre √† jour l'instance Wordpress</span>\nwp core update --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --allow-root\n\n<span class=\"token comment\"># Mise √† jour de tous les Th√®mes</span>\nwp theme update twentyfifteen twentysixteen\n<span class=\"token comment\"># Passage en mode auto update de tous les Th√®mes (recommand√©)</span>\nwp theme auto-updates <span class=\"token builtin class-name\">enable</span> --all\n\n<span class=\"token comment\"># Mise √† jour de tous les Plugins</span>\nwp plugin update --all\n<span class=\"token comment\"># Passage en mode auto update de tous les Plugins (recommand√©)</span>\nwp plugin auto-updates <span class=\"token builtin class-name\">enable</span> --all</code></pre></div>\n<h2>Mode maintenance</h2>\n<p><code class=\"language-text\">wp-cli</code> nous permet d'activer un mode \"maintenance\" avec <code class=\"language-text\">wp maintenance-mode</code></p>\n<blockquote>\n<p>Activates, deactivates or checks the status of the maintenance mode of a site.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp maintenance-mode &lt;command>\n  activate        Activates maintenance mode.\n  deactivate      Deactivates maintenance mode.\n  is-active       Detects maintenance mode status.\n  status          Displays maintenance mode status.</code></pre></div>\n<h2>Migration de nom de domaine</h2>\n<ul>\n<li>tester si une instance de WP tourne actuellement pour l'installation souhait√©e:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp core is-installed --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span></code></pre></div>\n<ul>\n<li>effectuer un backup complet de la base WP dans un .sql avec <code class=\"language-text\">wp db export</code> :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp db <span class=\"token builtin class-name\">export</span> --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> nom_de_mon_dump.sql</code></pre></div>\n<ul>\n<li>la commande <code class=\"language-text\">search</code> n'existant pas, il faut ruser et utiliser <code class=\"language-text\">wp search-replace</code> avec l'option <code class=\"language-text\">--dry-run</code> pour rechercher un √©l√©ment :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp search-replace http://ancien.com http://nouveau.com --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span> --dry-run</code></pre></div>\n<ul>\n<li>modifier en base toutes les occurences de l'ancien nom de domaine avec <code class=\"language-text\">wp search-replace</code> :</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp search-replace <span class=\"token string\">'http://ancien.com'</span> <span class=\"token string\">'http://nouveau.com'</span> --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress'</span></code></pre></div>\n<h2>Reset du mot de passe d'un utilisateur</h2>\n<p>Il est possible de modifier le mot de passe d'un utilisateur quelconque, notamment de l'admin sur une instance Wordpress sp√©cifique:</p>\n<p><code class=\"language-text\">wp user list</code>¬† pour r√©cup√©rer la liste des utilisateurs enregistr√©s, ainsi que leurs roles puis <code class=\"language-text\">wp user update</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wp user update login_de_l_utilisateur --user_pass<span class=\"token operator\">=</span><span class=\"token string\">\"nouveau_mot_de_passe\"</span>  --path<span class=\"token operator\">=</span><span class=\"token string\">'/var/www/wordpress/'</span></code></pre></div>"}},"staticQueryHashes":["1026020893","28434099","3153813225"]}