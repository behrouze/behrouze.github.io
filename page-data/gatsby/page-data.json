{"componentChunkName":"component---src-templates-wp-post-tsx","path":"/gatsby","result":{"pageContext":{"id":"407974c9-48b7-589d-8f2f-c693f25b0844","fileAbsolutePath":"/Users/behrouze/Sources/gatsby-blog/obsidian/Blog/gatsby.md","frontmatter":{"categories":["programmation"],"date":"2022-01-16","lastUpdate":"2022-02-07","tags":["gatsby","nextjs","gaphql","javascript","jamstack","react"],"title":"Gatsby"},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; box-shadow: 3px 5px 4px rgba(0,0,0,.1);margin:1rem;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/e8950/Gatsby_Logo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.699530516431924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVQY05WRS0uCYRSEH2/QKgqCCKRNOykou1nQjcRCRCNKIiIXKWFBV/u0kmxRubESIjRETQkEIVykEZW0bCdFf0aMeKP4XFSrBoaBA2dmYFgbuVw9deefg47cjUsfNSz1xVg3JpT8hUpmFWpZFfJd8c24vyhO3HkRle7F4dx1xVIfbLPWhapPM8AW0PDLqGpsBlp+xF54H8RkU6jiNsTKHlNauLoi4W6tFZVSMw34gHFgCDACE8AO4Ad6gU0gCAwDrYCOYuZNBB25d48pXb5LvQjJnDob1U+hVmkWASdgA16BKHAEZAEvEAMSQEDWcyBJIV4St/GSSAaeRHi58GFvPu4Ya5TQ1upq5IYHQCfgADbkgB7ADbjktv3ANjDLymBC2rVlSvv27KOzPTLks1wxP7CnVCpU/BMLX6N8AuLrXFP+qFeUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/bc663/Gatsby_Logo.webp 213w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/8dc4f/Gatsby_Logo.webp 425w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/10237/Gatsby_Logo.webp 850w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/5e05a/Gatsby_Logo.webp 1275w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/e5be3/Gatsby_Logo.webp 1700w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/b84eb/Gatsby_Logo.webp 2000w\"\n              sizes=\"(max-width: 850px) 100vw, 850px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/3cb16/Gatsby_Logo.png 213w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/2fbbf/Gatsby_Logo.png 425w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/ae694/Gatsby_Logo.png 850w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/3f20e/Gatsby_Logo.png 1275w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/dcb79/Gatsby_Logo.png 1700w,\n/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/e8950/Gatsby_Logo.png 2000w\"\n            sizes=\"(max-width: 850px) 100vw, 850px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fa38ab30a9b8abb4a1ff8c0b7fb86cef/ae694/Gatsby_Logo.png\"\n            alt=\"Gatsby Logo\"\n            title=\"Gatsby Logo\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Gatsby est un generateur de site static, et un √©l√©ment maitre dans l'univers de la <a href=\"https://jamstack.org/generators/\">JAMSTACK react</a>.</p>\n<blockquote>\n<p>Jamstack is an architecture designed to make the web faster, more secure, and easier to scale [...] The core principles of <a href=\"https://jamstack.org/glossary/pre-render\">pre-rendering</a>, and <a href=\"https://jamstack.org/glossary/decoupling\">decoupling</a>, enable sites and applications to be delivered with greater confidence and resilience than ever before.</p>\n</blockquote>\n<p>Avant de commencer lire ces quelques pages</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/conceptual/gatsby-core-philosophy/\">Gatsby Core Philosophy</a></li>\n<li>Guides des <a href=\"https://www.gatsbyjs.com/docs/conceptual\">conceptes</a></li>\n<li>les nouvelles options de rendu (<a href=\"https://www.gatsbyjs.com/docs/conceptual/rendering-options/\">SSR et DSG</a>) <a href=\"https://www.gatsbyjs.com/gatsby-4/\">Gatsby v4</a> le <a href=\"https://www.gatsbyjs.com/docs/conceptual/rendering-options/#static-site-generation-ssg\">Static Site Generation (SSG)</a> est le mode de rendu par d√©faut (<em>build time pre-rendering</em>)</li>\n</ul>\n<h1>Pages</h1>\n<p>Il existe 4 fa√ßon de cr√©er des pages avec Gatsby</p>\n<ul>\n<li><code class=\"language-text\">src/pages</code> : en cr√©ant un composant React (avec un export par default) dans ce dossier</li>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/\">File System Route API</a> : permet de cr√©er des <strong>collection route</strong> et <strong>client-only route</strong> gr√¢ce au <strong>Graphql data layer</strong> de Gatsby et de g√©n√©rer des pages en utilisant des placeholders (des crochets <code class=\"language-text\">[</code> et <code class=\"language-text\">]</code>) dans les noms de dossiers/fichiers (comme dans Nextjs)</li>\n<li><code class=\"language-text\">gatsby-node.js</code> : en implementant l'API <a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#createPages\"><code class=\"language-text\">createPages</code></a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/plugins/\">Plugins</a> : certains plugins peuvent cr√©er des pages (elles utilisent √©galement l'API <a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#createPages\"><code class=\"language-text\">createPages</code></a>)</li>\n</ul>\n<h1>Data</h1>\n<p>Avec Gatsby les donn√©es qui alimentent les pages peuvent provenir de requ√™tes POST (REST ou Graphql) :</p>\n<ul>\n<li>au <a href=\"https://www.gatsbyjs.com/docs/glossary#runtime\"><em>runtime</em></a> (classique pour les app Front)</li>\n<li>ou au <a href=\"https://www.gatsbyjs.com/docs/glossary#build\"><em>build time</em></a></li>\n</ul>\n<p>Cela permet de qualifier les pages g√©n√©r√©es par Gatsby d'<a href=\"https://www.gatsbyjs.com/docs/adding-app-and-website-functionality/#hybrid-app-pages\">hybrides</a>.</p>\n<p>L'<a href=\"https://www.gatsbyjs.com/docs/reference/graphql-data-layer/graphql-api/\">API Graphql</a> (<a href=\"https://www.gatsbyjs.com/docs/conceptual/graphql-concepts/#understanding-the-parts-of-a-query\">infos graphql</a>) permet d'interroger la couche de donn√©es de Gatsby ainsi que de <a href=\"https://www.gatsbyjs.com/docs/graphql-reference/#dates\">limit, skip, sort, filter, format</a> le r√©sultat de sa requ√™te.</p>\n<h2>Diff√©rents types de Query</h2>\n<p>Gatsby permet de requ√™ter des donn√©es dans :</p>\n<ul>\n<li>des <strong>pages</strong></li>\n<li>des <strong>composants</strong></li>\n<li>le fichier <strong>gatsby-node.js</strong>.</li>\n</ul>\n<p>Le requ√™tage s'effectue gr√¢ce √† des requ√™tes de type <strong>page query</strong> ou de <strong>static query</strong> selon le type de composants dans lequel on se trouve (page ou non).</p>\n<h2>Page Query</h2>\n<p>Il faut utiliser des requ√™tes de type Page Query pour interroger le Data Layer de Gatsby dans les <a href=\"https://www.gatsbyjs.com/docs/conceptual/building-with-components/#how-does-gatsby-use-react-components\">pages</a> Gatsby, c'est √† dire dans :</p>\n<ul>\n<li>composants React pr√©sents dans le dossier <code class=\"language-text\">src/pages</code></li>\n<li>pages cr√©√©es automatiquement lors de l'appel de <code class=\"language-text\">createPage</code> dans le fichier <code class=\"language-text\">gatsby-node.js</code> avec l'utilisation de l'option <code class=\"language-text\">component</code> qui va designer le composant qui sera consid√©r√© comme page</li>\n</ul>\n<p>La pageQuery est un [Tagged template](## <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates\" title=\"Permalink to Tagged templates\">Tagged templates</a>) qui va retourner des donn√©es disponibles via la props <code class=\"language-text\">data</code> du composant.\nGraphQL arguments for variables in your queries.</p>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/querying-data/page-query/\">Guide</a></p>\n<h2>Static Query</h2>\n<p>Utilisable dans un composant, l'utilisation d'une Static Query se fait via le hook <code class=\"language-text\">useStaticQuery</code> (ou √† l'ancienne üòã avec le composant <code class=\"language-text\">StaticQuery</code>).</p>\n<p>You can only have one <code class=\"language-text\">StaticQuery</code> per page: in order to include the data you need from multiple sources, you can use one query with multiple <a href=\"https://www.gatsbyjs.com/docs/conceptual/graphql-concepts/#query-fields\">root fields</a>. It cannot take variables as arguments.</p>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/querying-data/static-query/\">Guide</a></p>\n<h2>Ne pas m√©langer</h2>\n<p>Dans un fichier donn√© (page ou composant) n'est pas possbile de :</p>\n<ol>\n<li><em>m√©langer les 2 types de Queries</em></li>\n<li>d'avoir <em>plusieurs query</em> par composant, il est possible d'utiliser une requ√™tes avec plusieurs <a href=\"https://www.gatsbyjs.com/docs/conceptual/graphql-concepts/#query-fields\">root fields</a></li>\n</ol>\n<h2>Sourcing via un plugin</h2>\n<p>Pour sourcer notre application en donn√©es via un source plugin, il faut:</p>\n<ol>\n<li>d'abord l'installer <code class=\"language-text\">npm i gatsby-source-xxxx</code> puis l'ajouter au fichier de config <a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-config/\"><code class=\"language-text\">gatsby-config.js</code></a></li>\n<li>√©crire une <a href=\"https://www.gatsbyjs.com/docs/how-to/querying-data/use-static-query/\">static query</a> qui va r√©ccup√©rer de la donn√©es au buid time :</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> useStaticQuery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">IndexPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gatsbyRepoData <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    query {\n      github {\n        repository(name: \"gatsby\", owner: \"gatsbyjs\") {\n          id\n          nameWithOwner\n          url\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><sub>exemple tir√© de la doc officielle: <a href=\"https://www.gatsbyjs.com/docs/conceptual/data-fetching/\">https://www.gatsbyjs.com/docs/conceptual/data-fetching/</a></sub>\n3. lors du build, la <a href=\"https://www.gatsbyjs.com/docs/static-vs-normal-queries/#distinguishing-between-static-and-normal-queries\">requ√™te graphql est ex√©cut√©e et remplac√©e</a> pour g√©n√©rer un fichier JSON\n4. toujours lors du build, le JSON est dynamiquement import√© dans le JSX</p>\n<h2>Liens</h2>\n<p>voir compl√©ment d'infos dans:</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/conceptual/data-fetching/\">Build Time and Client Runtime Data Fetching</a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/adding-app-and-website-functionality/#page-and-route-creation\">Adding App and Website Functionality</a>)</li>\n<li><a href=\"https://www.gatsbyjs.com/docs/conceptual/react-hydration\">Understanding React Hydration guide</a></li>\n<li>the process of fetching data at build time and creating pages from the data is <a href=\"https://www.gatsbyjs.com/docs/tutorial/part-5/\">covered in more depth in the tutorial</a> as well as the docs for <a href=\"https://www.gatsbyjs.com/docs/programmatically-create-pages-from-data/\">creating pages from data programmatically</a>.</li>\n</ul>\n<h1>Routing</h1>\n<h2>Routing par d√©faut</h2>\n<p>Tout composant situ√© dans  <code class=\"language-text\">src/pages</code> sera accessible via son nom de fichier <a href=\"#Slugs\">slugis√©</a>\nUne page index.js situ√© dans un sous dossier sera accessible via le nom du dossier <code class=\"language-text\">src/pages/blog/index.js</code> sera accessible via <code class=\"language-text\">/blog</code>.</p>\n<h2>Gatsby‚Äôs File System Route API</h2>\n<p>Tous les composants situ√©s dans /pages (et dessous) seront rout√©s automatiquement.\nPar ex les pages dynamiques du type <code class=\"language-text\">src/pages/blog/{mdx.slug}.js</code> seront accessible via l'url <code class=\"language-text\">/blog/xxx</code>.</p>\n<p><a href=\"https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/#collection-route--fallback\">2 exemples de routing</a> :\n- <code class=\"language-text\">src/pages/products/{Product.name}.js</code> (collection route)\n- <code class=\"language-text\">src/pages/products/[name].js</code> (client-only route, fallback)</p>\n<h1>Slugs</h1>\n<p>Avec le plugin <code class=\"language-text\">gatsby-plugin-mdx</code> Gatsby g√©n√®re automatiquement des noeuds slug avec le nom du fichier sans l'extension.</p>\n<p>Si on souhaite g√©n√©rer les slugs nous meme, Gatsby <a href=\"https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/#routing-and-linking\">‚Äúslugify‚Äù</a> automatiquement toutes les routes:\nex <code class=\"language-text\">I ‚ô• Dogs</code> sera automatiquement converti en  <code class=\"language-text\">i-love-dogs</code>.</p>\n<h1>Tips</h1>\n<p>Faire le <a href=\"https://www.gatsbyjs.com/docs/tutorial/\">tuto officiel</a>.</p>\n<ul>\n<li><code class=\"language-text\">gatsby clean</code> permet de vider le cache. Utile apr√®s d√©placement de fichiers ou renommages par ex. Relancer ensuite le script npm</li>\n<li><code class=\"language-text\">gatsby info</code></li>\n</ul>\n<h2>Debug dans VSCode</h2>\n<p><a href=\"https://www.gatsbyjs.com/docs/debugging-the-build-process/#vs-code-debugger-auto-config\">https://www.gatsbyjs.com/docs/debugging-the-build-process/#vs-code-debugger-auto-config</a></p>"}},"staticQueryHashes":["1026020893","2750442709","28434099"]}